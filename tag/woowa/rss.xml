<?xml version="1.0" encoding="UTF-8" ?>

<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
<channel>
   
      <title>NewWisdom.github.io/</title>
   
   <link>http://localhost:4000</link>
   <description>I want to be a person who gives you new wisdom.</description>
   <language>ko-KR</language>
   <managingEditor> </managingEditor>
   <atom:link href="rss" rel="self" type="application/rss+xml" />
   
	<item>
	  <title>📋 통합 테스트 VS 단위 테스트</title>
	  <link>//unit-test-vs</link>
	  <author></author>
	  <pubDate>2021-04-16T19:18:00+09:00</pubDate>
	  <guid>//unit-test-vs</guid>
	  <description><![CDATA[
	     <h2 id="통합-테스트">통합 테스트</h2>

<p>실제 운영 환경에서 사용될 클래스들을 통합하여 테스트한다.<br />
기능 검증이 아닌 스프링 프레임워크에서 전체적으로 플로우가 제대로 동작하는지 검증하기 위해 사용한다.</p>

<h4 id="장점">장점</h4>

<ul>
  <li>스프링 부트 컨테이너를 띄워 테스트하기 때문에 운영환경과 가장 유사한 테스트가 가능하다.</li>
  <li>전체적인 Flow를 쉽게 테스트 할 수 있다.</li>
</ul>

<h4 id="단점">단점</h4>

<ul>
  <li>애플리케이션의 설정, 모든 Bean을 로드하기 때문에 시간이 오래걸리고 무겁다.</li>
  <li>테스트 단위가 커 디버깅이 어렵다.</li>
</ul>

<h3 id="springboottest"><strong>@SpringBootTest</strong></h3>

<ul>
  <li>통합 테스트를 제공하는 기본적인 스프링 부트 테스트 어노테이션.</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SpringBootTest</span>
<span class="nd">@ActiveProfiles</span><span class="o">(</span><span class="s">"test"</span><span class="o">)</span>
<span class="nd">@Transactional</span>
<span class="kd">class</span> <span class="nc">ChessServiceImplTest</span> <span class="o">{</span>
  <span class="c1">// ...</span>
<span class="o">}</span>
</code></pre></div></div>

<h4 id="springboottest-의-파라미터들">@SpringBootTest 의 파라미터들</h4>

<ul>
  <li><strong>value</strong>: 테스트가 실행되기 전에 적용할 프로퍼티 주입.(기존의 프로퍼티 오버라이드)</li>
  <li><strong>properties</strong> : 테스트가 실행되기 전에 {key=value} 형식으로 프로퍼티 추가.</li>
  <li><strong>classes</strong> : ApplicationContext에 로드할 클래스 지정. (지정하지 않으면 @SpringBootConfiguration을 찾아서 로드)</li>
  <li><strong>webEnvironment</strong> : 어플리케이션이 실행될 때의 웹 환경을 설정. (기본값은 Mock 서블릿을 로드하여 구동)</li>
</ul>

<p><strong>➕ webEnvironment</strong></p>

<ul>
  <li><strong>MOCK</strong> : <code class="highlighter-rouge">ServletContainer</code>를 테스트용으로 띄우지않고 서블릿을 mocking 한 것이 동작한다. (내장 톰캣이 구동되지 않는다.) <br />
MockMvc는 브라우저에서 요청과 응답을 의미하는 객체로서 Controller 테스테 사용을 용이하게 해주는 라이브러리</li>
  <li><strong>RANDOM_PORT</strong> : 임의의 Port Listener. EmbeddedWebApplicationContext를 로드하며 실제 서블릿 환경을 구성</li>
</ul>

<h4 id="activeprofiles">@ActiveProfiles</h4>

<p>원하는 프로파일 환경 값 설정이 가능하다. (프로파일 전략)</p>

<h4 id="transactional">@Transactional</h4>

<p>테스트 완료 후 자동으로 Rollback 처리가 된다. <br />
하지만 <code class="highlighter-rouge">WebEnvironment.RANDOM_PORT, DEFINED_PORT</code>를 사용하면 실제 테스트 서버는 별도의 스레드에서 테스트를 수행하기 떄문에 트랜잭션이 롤백되지 않는다. (왜?)</p>

<hr />

<h2 id="단위-테스트">단위 테스트</h2>

<h4 id="장점-1">장점</h4>

<ul>
  <li>WebApplication 관련된 Bean들만 등록하기 때문에 통합 테스트보다 빠르다.</li>
  <li>통합 테스트를 진행하기 어려운 테스트를 진행 가능하다.</li>
</ul>

<h4 id="단점-1">단점</h4>

<ul>
  <li>요청부터 응답까지 모든 테스트를 Mock 기반으로 테스트하기 때문에 실제 환경에서는 제대로 동작하지 않을 수 있다.</li>
</ul>

<h3 id="webmvctest">@WebMvcTest</h3>

<ul>
  <li>MVC를 위한 테스트로, 웹 상에서 요청과 응답에 대한 테스트.</li>
  <li>MVC 관련된 설정인 <code class="highlighter-rouge">@Controller, @ControllerAdvice, @JsonCompoent와 Filter, WebMvcConfiguer, HandlerMetohdAgumentResolver</code>만 빈으로 등록된다.</li>
  <li>때문에 Service, Repository 와 같은 웹 계층 아래 빈들은 등록되지 않아 의존성도 끊긴다.</li>
  <li>테스트에 사용하는 의존성이 있다면 @MockBean으로 만들어 사용한다.</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@WebMvcTest</span><span class="o">(</span><span class="n">ChessController</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">ChessControllerTest</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="kt">long</span> <span class="n">CHESS_GAME_TEST_ID</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="n">MockMvc</span> <span class="n">mockMvc</span><span class="o">;</span>

    <span class="nd">@MockBean</span>
    <span class="n">ChessService</span> <span class="n">chessService</span><span class="o">;</span>

    <span class="nd">@Test</span>
    <span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"게임 리스트 조회 테스트"</span><span class="o">)</span>
    <span class="kt">void</span> <span class="nf">getGames</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ChessGameManager</span><span class="o">&gt;</span> <span class="n">chessGameManagers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="n">ChessGameManager</span> <span class="n">chessGameManager</span> <span class="o">=</span> <span class="n">ChessGameManagerFactory</span><span class="o">.</span><span class="na">createRunningGame</span><span class="o">(</span><span class="n">CHESS_GAME_TEST_ID</span><span class="o">);</span>
        <span class="n">chessGameManagers</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">chessGameManager</span><span class="o">);</span>

        <span class="n">given</span><span class="o">(</span><span class="n">chessService</span><span class="o">.</span><span class="na">findRunningGames</span><span class="o">()).</span><span class="na">willReturn</span><span class="o">(</span><span class="k">new</span> <span class="n">ChessGameManagerBundle</span><span class="o">(</span><span class="n">chessGameManagers</span><span class="o">));</span>

        <span class="n">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span><span class="n">get</span><span class="o">(</span><span class="s">"/games"</span><span class="o">))</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">status</span><span class="o">().</span><span class="na">isOk</span><span class="o">())</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">jsonPath</span><span class="o">(</span><span class="s">"$.runningGames."</span> <span class="o">+</span> <span class="n">CHESS_GAME_TEST_ID</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">value</span><span class="o">(</span><span class="s">"WHITE"</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"새로운 게임 시작 테스트"</span><span class="o">)</span>
    <span class="kt">void</span> <span class="nf">gameStart</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">ChessGameManager</span> <span class="n">chessGameManager</span> <span class="o">=</span> <span class="n">ChessGameManagerFactory</span><span class="o">.</span><span class="na">createRunningGame</span><span class="o">(</span><span class="n">CHESS_GAME_TEST_ID</span><span class="o">);</span>

        <span class="n">given</span><span class="o">(</span><span class="n">chessService</span><span class="o">.</span><span class="na">start</span><span class="o">()).</span><span class="na">willReturn</span><span class="o">(</span><span class="n">chessGameManager</span><span class="o">);</span>

        <span class="n">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span><span class="n">get</span><span class="o">(</span><span class="s">"/game/start"</span><span class="o">))</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">status</span><span class="o">().</span><span class="na">isOk</span><span class="o">())</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">jsonPath</span><span class="o">(</span><span class="s">"$.id"</span><span class="o">).</span><span class="na">value</span><span class="o">(</span><span class="n">CHESS_GAME_TEST_ID</span><span class="o">))</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">jsonPath</span><span class="o">(</span><span class="s">"$.color"</span><span class="o">).</span><span class="na">value</span><span class="o">(</span><span class="s">"WHITE"</span><span class="o">))</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">jsonPath</span><span class="o">(</span><span class="s">"$.piecesAndPositions.size()"</span><span class="o">).</span><span class="na">value</span><span class="o">(</span><span class="mi">32</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"게임 점수 조회 테스트"</span><span class="o">)</span>
    <span class="kt">void</span> <span class="nf">getScore</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">ChessGameStatistics</span> <span class="n">chessGameStatistics</span> <span class="o">=</span> <span class="n">ChessGameStatistics</span><span class="o">.</span><span class="na">createNotStartGameResult</span><span class="o">();</span>

        <span class="n">given</span><span class="o">(</span><span class="n">chessService</span><span class="o">.</span><span class="na">getStatistics</span><span class="o">(</span><span class="n">CHESS_GAME_TEST_ID</span><span class="o">)).</span><span class="na">willReturn</span><span class="o">(</span><span class="n">chessGameStatistics</span><span class="o">);</span>

        <span class="n">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span><span class="n">get</span><span class="o">(</span><span class="s">"/game/"</span> <span class="o">+</span> <span class="n">CHESS_GAME_TEST_ID</span> <span class="o">+</span> <span class="s">"/score"</span><span class="o">))</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">status</span><span class="o">().</span><span class="na">isOk</span><span class="o">())</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">jsonPath</span><span class="o">(</span><span class="s">"$.matchResult"</span><span class="o">).</span><span class="na">value</span><span class="o">(</span><span class="s">"무승부"</span><span class="o">))</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">jsonPath</span><span class="o">(</span><span class="s">"$.colorsScore.size()"</span><span class="o">).</span><span class="na">value</span><span class="o">(</span><span class="mi">2</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"해당 게임 로딩 테스트"</span><span class="o">)</span>
    <span class="kt">void</span> <span class="nf">loadGame</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">ChessGameManager</span> <span class="n">chessGameManager</span> <span class="o">=</span> <span class="n">ChessGameManagerFactory</span><span class="o">.</span><span class="na">createRunningGame</span><span class="o">(</span><span class="n">CHESS_GAME_TEST_ID</span><span class="o">);</span>

        <span class="n">given</span><span class="o">(</span><span class="n">chessService</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">CHESS_GAME_TEST_ID</span><span class="o">)).</span><span class="na">willReturn</span><span class="o">(</span><span class="n">chessGameManager</span><span class="o">);</span>

        <span class="n">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span><span class="n">get</span><span class="o">(</span><span class="s">"/game/"</span> <span class="o">+</span> <span class="n">CHESS_GAME_TEST_ID</span> <span class="o">+</span> <span class="s">"/load"</span><span class="o">))</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">status</span><span class="o">().</span><span class="na">isOk</span><span class="o">())</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">jsonPath</span><span class="o">(</span><span class="s">"$.id"</span><span class="o">).</span><span class="na">value</span><span class="o">(</span><span class="n">CHESS_GAME_TEST_ID</span><span class="o">))</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">jsonPath</span><span class="o">(</span><span class="s">"$.color"</span><span class="o">).</span><span class="na">value</span><span class="o">(</span><span class="s">"WHITE"</span><span class="o">))</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">jsonPath</span><span class="o">(</span><span class="s">"$.piecesAndPositions.size()"</span><span class="o">).</span><span class="na">value</span><span class="o">(</span><span class="mi">32</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">movePiece</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">Gson</span> <span class="n">gson</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Gson</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">content</span> <span class="o">=</span> <span class="n">gson</span><span class="o">.</span><span class="na">toJson</span><span class="o">(</span><span class="k">new</span> <span class="n">MoveRequestDto</span><span class="o">(</span><span class="s">"a2"</span><span class="o">,</span> <span class="s">"a3"</span><span class="o">));</span>

        <span class="n">given</span><span class="o">(</span><span class="n">chessService</span><span class="o">.</span><span class="na">isEnd</span><span class="o">(</span><span class="n">CHESS_GAME_TEST_ID</span><span class="o">)).</span><span class="na">willReturn</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
        <span class="n">given</span><span class="o">(</span><span class="n">chessService</span><span class="o">.</span><span class="na">nextColor</span><span class="o">(</span><span class="n">CHESS_GAME_TEST_ID</span><span class="o">)).</span><span class="na">willReturn</span><span class="o">(</span><span class="n">Color</span><span class="o">.</span><span class="na">BLACK</span><span class="o">);</span>

        <span class="n">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span><span class="n">MockMvcRequestBuilders</span>
                <span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="s">"/game/"</span> <span class="o">+</span> <span class="n">CHESS_GAME_TEST_ID</span> <span class="o">+</span> <span class="s">"/move"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">content</span><span class="o">(</span><span class="n">content</span><span class="o">).</span><span class="na">header</span><span class="o">(</span><span class="s">"Content-Type"</span><span class="o">,</span> <span class="s">"application/json"</span><span class="o">))</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">status</span><span class="o">().</span><span class="na">isOk</span><span class="o">())</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">jsonPath</span><span class="o">(</span><span class="s">"$.end"</span><span class="o">).</span><span class="na">value</span><span class="o">(</span><span class="kc">false</span><span class="o">))</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">jsonPath</span><span class="o">(</span><span class="s">"$.nextColor"</span><span class="o">).</span><span class="na">value</span><span class="o">(</span><span class="s">"BLACK"</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li><code class="highlighter-rouge">given - willReturn</code> : 특정행위에 대한 반환 값을 지정하여 실제 객체처럼 동작하게 한다.</li>
</ul>

<h3 id="jdbctest">@JdbcTest</h3>

<ul>
  <li>JDBC 기반 구성 요소에만 초점을 맞춘 JDBC 테스트 어노테이션</li>
  <li>테스트를 위한 <code class="highlighter-rouge">JdbcTemplate</code>이 생성된다.</li>
  <li>기본적으로 트랜잭션이 이루어진다.</li>
  <li>in-memory database가 설정된다.</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@JdbcTest</span>
<span class="kd">class</span> <span class="nc">JdbcTemplateChessDaoTest</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">DEFAULT_CHESS_GAME_ID</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
    <span class="n">ChessGame</span> <span class="n">chessGame</span><span class="o">;</span>
    <span class="n">ChessGameManager</span> <span class="n">sampleGame</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">JdbcTemplate</span> <span class="n">jdbcTemplate</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">JdbcTemplateChessDao</span> <span class="n">jdbcTemplateChessDao</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="kd">public</span> <span class="nf">JdbcTemplateChessDaoTest</span><span class="o">(</span><span class="n">JdbcTemplate</span> <span class="n">jdbcTemplate</span><span class="o">,</span> <span class="nd">@Qualifier</span><span class="o">(</span><span class="s">"dataSource"</span><span class="o">)</span> <span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">jdbcTemplate</span> <span class="o">=</span> <span class="n">jdbcTemplate</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">jdbcTemplateChessDao</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JdbcTemplateChessDao</span><span class="o">(</span><span class="n">jdbcTemplate</span><span class="o">,</span> <span class="n">dataSource</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@BeforeEach</span>
    <span class="kt">void</span> <span class="nf">beforeEach</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">sample</span> <span class="o">=</span> <span class="s">"RKBQKBKRPPPPPPPP................................pppppppprkbqkbkr"</span><span class="o">;</span> <span class="c1">// move a2 a3 한 번 진행</span>
        <span class="n">chessGame</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ChessGame</span><span class="o">(</span><span class="n">DEFAULT_CHESS_GAME_ID</span><span class="o">,</span> <span class="n">WHITE</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="n">sample</span><span class="o">);</span>
        <span class="n">sampleGame</span> <span class="o">=</span> <span class="n">ChessGameManagerFactory</span><span class="o">.</span><span class="na">loadingGame</span><span class="o">(</span><span class="n">chessGame</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"체스 게임을 저장한다."</span><span class="o">)</span>
    <span class="kt">void</span> <span class="nf">save</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">long</span> <span class="n">newId</span> <span class="o">=</span> <span class="n">jdbcTemplateChessDao</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">chessGame</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">newId</span><span class="o">).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"id로 체스 게임을 찾는다."</span><span class="o">)</span>
    <span class="kt">void</span> <span class="nf">findById</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">jdbcTemplateChessDao</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">DEFAULT_CHESS_GAME_ID</span><span class="o">).</span><span class="na">isPresent</span><span class="o">()).</span><span class="na">isTrue</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"체스 게임 정보를 업데이트한다."</span><span class="o">)</span>
    <span class="kt">void</span> <span class="nf">update</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">sampleGame</span><span class="o">.</span><span class="na">move</span><span class="o">(</span><span class="n">Position</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"a2"</span><span class="o">),</span> <span class="n">Position</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"a4"</span><span class="o">));</span>

        <span class="n">jdbcTemplateChessDao</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="k">new</span> <span class="n">ChessGame</span><span class="o">(</span><span class="n">sampleGame</span><span class="o">));</span>

        <span class="n">ChessGame</span> <span class="n">expectedChessGame</span> <span class="o">=</span> <span class="n">jdbcTemplateChessDao</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">DEFAULT_CHESS_GAME_ID</span><span class="o">).</span><span class="na">get</span><span class="o">();</span>
        <span class="n">ChessGameManager</span> <span class="n">expectedChessGameManager</span> <span class="o">=</span> <span class="n">ChessGameManagerFactory</span><span class="o">.</span><span class="na">loadingGame</span><span class="o">(</span><span class="n">expectedChessGame</span><span class="o">);</span>
        <span class="n">Square</span> <span class="n">a4</span> <span class="o">=</span> <span class="n">expectedChessGameManager</span><span class="o">.</span><span class="na">getBoard</span><span class="o">().</span><span class="na">findByPosition</span><span class="o">(</span><span class="n">Position</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"a4"</span><span class="o">));</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">a4</span><span class="o">.</span><span class="na">getPiece</span><span class="o">().</span><span class="na">getClass</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="n">Pawn</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">a4</span><span class="o">.</span><span class="na">getPiece</span><span class="o">().</span><span class="na">getColor</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="n">WHITE</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">findAllOnRunning</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">ChessGame</span><span class="o">&gt;</span> <span class="n">allOnRunning</span> <span class="o">=</span> <span class="n">jdbcTemplateChessDao</span><span class="o">.</span><span class="na">findAllOnRunning</span><span class="o">();</span>

        <span class="n">assertThat</span><span class="o">(</span><span class="n">allOnRunning</span><span class="o">.</span><span class="na">size</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">delete</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">//when</span>
        <span class="n">jdbcTemplateChessDao</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">DEFAULT_CHESS_GAME_ID</span><span class="o">);</span>

        <span class="c1">//then</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">jdbcTemplateChessDao</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">DEFAULT_CHESS_GAME_ID</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

	  ]]></description>
	</item>

	<item>
	  <title>📋 스프링 입문 - 코드로 배우는 스프링 부트, 웹 MVC, DB 접근 기술 강의 노트</title>
	  <link>//spring-core-lecture</link>
	  <author></author>
	  <pubDate>2021-04-16T19:18:00+09:00</pubDate>
	  <guid>//spring-core-lecture</guid>
	  <description><![CDATA[
	     <p>객체의 의존 관리는 스프링이 한다.<br />
스프링은 개발자를 대신해서 객체들을 생성하고 관리하는 일을 한다.</p>

<h3 id="chessservice에서-chessdao-의존하기">ChessService에서 ChessDao 의존하기</h3>

<p><img src="/Users/jyejye/Library/Application Support/typora-user-images/image-20210420104423745.png" alt="image-20210420104423745" /></p>

<p>변경에 취약하다</p>

<p>의존 관계를 개발자가 직접 관리하려면 복잡하다.<br />
스프링 컨테이너가 관리해준다.</p>

<h3 id="컨테이너">컨테이너</h3>

<p>담아놓는 용기<br />
스프링에서는 스프링이 활용할 객체들을 담아놓은 용기를 말한다.</p>

<h3 id="bean으로-등록하는-기준">Bean으로 등록하는 기준?</h3>

<p>프로그램 별로 공통적으로 쓸 수 있는 대상 
레이어에 대한 객체들을 재사용할 수 있는데 이들을 빈으로 관리한다.<br />
상태가 없는 객체를 빈으로 등록한다.  -&gt; 빈으로 등록 하려면 상태가 없어야 한다.</p>

<p>설정의 메타 데이터(Configuration Metadata)를 이용해 스프링 컨테이너에 담아놓는다.<br />
컨테이너에 담으면 빈으로 등록된다.</p>

<h3 id="스프링이-객체를-관리하게-하려면">스프링이 객체를 관리하게 하려면</h3>

<ul>
  <li>객체 관리 대상 알려주기</li>
  <li>객체들 간의 의존성 정의하기</li>
</ul>

<h3 id="컨테이너-설정-방법---빈-등록-방법">컨테이너 설정 방법 - 빈 등록 방법</h3>

<p>@ComponentScan : 등록할 빈을 스캔할 classpath를 지정 (@SpringBootApplication 내부에 속해있는 애너테이션)</p>

<p>@Component : ComponentScan 클래스 하위에 특정 애너테이션이 붙은 클래스를 스프링 빈으로 지정</p>

<p><img src="/Users/jyejye/Library/Application Support/typora-user-images/image-20210420110038067.png" alt="image-20210420110038067" /></p>

<h3 id="의존성-주입">의존성 주입</h3>

<h4 id="생성자-주입without-스프링-컨테이너">생성자 주입(without 스프링 컨테이너)</h4>

<h4 id="수정자-주입without-스프링-컨테이너">수정자 주입(without 스프링 컨테이너)</h4>

<p>필드를 통해 주입할 수도 있다.<br />
스프링에서는 XML, 어노테이션, 자바 클래스를 통해 의존성을 주입할 수 있다.</p>

<p>@Autowired를 붙여준다. 생성자 매개변수의 값이 필요하구나를 알 수 있다.</p>

<p>특정 컴포넌트 어노테이션을 붙인다고 해서 특정 의미가 부여되는 것은 아니고,</p>

<p>Repository는 도메인 객체의 생명주기를 관리하며 Public Operation을 제공합니다. 이에 Domain Layer에 해당합니다. 도메인 모델과 생애주기가 같기 때문이죠. 
실제 구현체인 SimpleJpaRepository는 Infrastructure Layer에 해당합니다. 
이렇게 추상에 의존하고 구체에 의존하지 않도록 구성함으로써(DIP) 유연성있는 시스템을 구성할 수 있습니다.
반면, DAO는 CRUD와 1:1로 매칭되어 Persistence Operation을 적극적으로 드러냅니다.
즉, repository는 도메인 모델의 일부로 보며 추상인 반면, dao는 추상이 필수는 아니라고 생각합니다.</p>

<blockquote>
  <p>http://egloos.zum.com/aeternum/v/1160846</p>
</blockquote>

<blockquote>
  <p>https://stackoverflow.com/questions/8550124/what-is-the-difference-between-dao-and-repository-patterns</p>
</blockquote>

<p>빈은 기본적으로 싱글턴 스코프</p>

<p>컨테이너는 개념적인 것 컨텍스트는 객체의 일원</p>

<p>갠적으로 어노테이션은 막붙이기 좋고(빠르게 개발하기)
xml에 명시하면 일률적으로 내가 어떻게 관리하고 있는지 눈에 들어와서 좋았습니다.</p>

<p><img src="/Users/jyejye/Library/Application Support/typora-user-images/image-20210420114253606.png" alt="image-20210420114253606" /></p>

<h3 id="서비스-레이어는-어떤-역할을-할까요">서비스 레이어는 어떤 역할을 할까요?</h3>

<p>도메인 로직들의 순서를 보장하면서, 서비스 트랜잭션 관리를 한다.<br />
객체들의 비지니스 플로우를 관리해준다.<br />
비지니스 로직은 도메인으로!</p>

<h3 id="pojo">Pojo</h3>

<p>스프링에서 스프링 빈으로 관리하고 싶은 객체<br />
스프링 설정이 가해지기 전 상태의 객체를 POJO라고 한다.</p>

<p>포조는 순수한 자바 객체를 의미</p>

<p>Java Bean :</p>

<p>자바빈은 포조라고 할 수 있지만 포조는 자바빈이라고 하긴 애매하다.</p>

<p><img src="/Users/jyejye/Library/Application Support/typora-user-images/image-20210420120440979.png" alt="image-20210420120440979" /></p>

<p>뷰 컨트롤러를 분리했다고 보면 됨 그런 차원에서 의미가 있따.</p>

<p>맞아유 config가 코드 양이 좀 더 짧은 거 같아서 더 좋은 거 같아여! 어차피 configuration은 대부분 만들어 놓으니 다른 클래스 안만들어도 되구!</p>


	  ]]></description>
	</item>

	<item>
	  <title>📋 스프링 입문 - 코드로 배우는 스프링 부트, 웹 MVC, DB 접근 기술 강의 노트</title>
	  <link>//spring3</link>
	  <author></author>
	  <pubDate>2021-04-16T19:18:00+09:00</pubDate>
	  <guid>//spring3</guid>
	  <description><![CDATA[
	     <h2 id="3-회원-관리-예제---백엔드-개발">3. 회원 관리 예제 - 백엔드 개발</h2>

<hr />

<h3 id="비즈니스-요구사항">비즈니스 요구사항</h3>

<ul>
  <li>데이터 : 회원 ID, 이름</li>
  <li>기능 : 회원 등록, 조회</li>
  <li>아직 데이터 저장소가 선정되지 않음</li>
</ul>

<h4 id="일반적인-웹-애플리케이션-계층-구조">일반적인 웹 애플리케이션 계층 구조</h4>

<ul>
  <li>컨트롤러 : 웹 MVC의 컨트롤러 역할</li>
  <li>서비스 : 핵심 비즈니스 로직 구현</li>
  <li>레포지토리 : 데이터베이스에 접근, 도메인 객체를 DB에 저장하고 관리</li>
  <li>도메인 : 비즈니스</li>
</ul>

<h4 id="클래스-의존-관계">클래스 의존 관계</h4>

<p><img src="https://user-images.githubusercontent.com/43840561/114995962-5371f080-9ed9-11eb-9f24-561a7af4dd46.png" alt="image" style="zoom:33%;" /></p>

<p>회원을 저장하는 것은 Repository 인터페이스.<br />
일단은 메모리 구현체.<br />
DBMS를 자유롭게 바꿔 끼우기 위해 인터페이스로 구현하였음.</p>

<p><strong>Member Domain</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Member</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">Long</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>MemberRepository</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MemberRepository</span> <span class="o">{</span>
    <span class="n">Member</span> <span class="nf">save</span><span class="o">(</span><span class="n">Member</span> <span class="n">member</span><span class="o">);</span>
    <span class="n">Optional</span><span class="o">&lt;</span><span class="n">Member</span><span class="o">&gt;</span> <span class="nf">findById</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">);</span>
    <span class="n">Optional</span><span class="o">&lt;</span><span class="n">Member</span><span class="o">&gt;</span> <span class="nf">findByNames</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">);</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Member</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li><code class="highlighter-rouge">findById()</code>, <code class="highlighter-rouge">findByNames()</code> 은 null을 반환할 수 있으니 Optional로 감싸서 반환한다.</li>
</ul>

<p><strong>MemoryMemberRepository</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemoryMemberRepository</span> <span class="kd">implements</span> <span class="n">MemberRepository</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span> <span class="n">Member</span><span class="o">&gt;</span> <span class="n">store</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">long</span> <span class="n">sequence</span> <span class="o">=</span> <span class="mi">0L</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Member</span> <span class="nf">save</span><span class="o">(</span><span class="n">Member</span> <span class="n">member</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">member</span><span class="o">.</span><span class="na">setId</span><span class="o">(++</span><span class="n">sequence</span><span class="o">);</span>
        <span class="n">store</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">member</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">member</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">member</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">Member</span><span class="o">&gt;</span> <span class="nf">findById</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">(</span><span class="n">store</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">));</span> <span class="c1">// null이어도 감쌀 수 있다. 클라에서 무언갈 할 수 있</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">Member</span><span class="o">&gt;</span> <span class="nf">findByNames</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">store</span><span class="o">.</span><span class="na">values</span><span class="o">().</span><span class="na">stream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">member</span> <span class="o">-&gt;</span> <span class="n">member</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">name</span><span class="o">))</span>
                <span class="o">.</span><span class="na">findAny</span><span class="o">();</span> <span class="c1">// 루프를 돌면서 없으면 optional에 null이 포함되서 반환</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Member</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;(</span><span class="n">store</span><span class="o">.</span><span class="na">values</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>MemoryMemberRepositoryTest</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemoryMemberRepositoryTest</span> <span class="o">{</span>
    <span class="n">MemoryMemberRepository</span> <span class="n">repository</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MemoryMemberRepository</span><span class="o">();</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">save</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Member</span> <span class="n">member</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Member</span><span class="o">();</span>
        <span class="n">member</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"spring"</span><span class="o">);</span>

        <span class="n">repository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">member</span><span class="o">);</span>

        <span class="n">Member</span> <span class="n">result</span> <span class="o">=</span> <span class="n">repository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">member</span><span class="o">.</span><span class="na">getId</span><span class="o">()).</span><span class="na">get</span><span class="o">();</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">member</span><span class="o">).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">findByName</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Member</span> <span class="n">member1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Member</span><span class="o">();</span>
        <span class="n">member1</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"spring1"</span><span class="o">);</span>
        <span class="n">repository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">member1</span><span class="o">);</span>

        <span class="n">Member</span> <span class="n">member2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Member</span><span class="o">();</span>
        <span class="n">member2</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"spring2"</span><span class="o">);</span>
        <span class="n">repository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">member2</span><span class="o">);</span>

        <span class="n">Member</span> <span class="n">result</span> <span class="o">=</span> <span class="n">repository</span><span class="o">.</span><span class="na">findByNames</span><span class="o">(</span><span class="s">"spring1"</span><span class="o">).</span><span class="na">get</span><span class="o">();</span>

        <span class="n">assertThat</span><span class="o">(</span><span class="n">result</span><span class="o">).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="n">member1</span><span class="o">);</span>
    <span class="o">}</span>
  
  <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">findAll</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Member</span> <span class="n">member1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Member</span><span class="o">();</span>
        <span class="n">member1</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"spring1"</span><span class="o">);</span>
        <span class="n">repository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">member1</span><span class="o">);</span>

        <span class="n">Member</span> <span class="n">member2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Member</span><span class="o">();</span>
        <span class="n">member2</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"spring2"</span><span class="o">);</span>
        <span class="n">repository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">member2</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>모든 테스트는 메서드마다 독립적으로 실행되어야 한다.<br />
순서에 의존도가 생기면 안된다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@AfterEach</span>
<span class="kt">void</span> <span class="nf">afterAll</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">repository</span><span class="o">.</span><span class="na">clearStore</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p>때문에 하나의 테스트가 실행될 때 마다 초기화를 진행해준다.</p>

<p>테스트 코드없이 개발은 불가능하다.</p>

<p><strong>MemberService</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemberService</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">MemberRepository</span> <span class="n">memberRepository</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MemoryMemberRepository</span><span class="o">();</span>

    <span class="kd">public</span> <span class="kt">long</span> <span class="nf">join</span><span class="o">(</span><span class="n">Member</span> <span class="n">member</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">validateDuplicatedMember</span><span class="o">(</span><span class="n">member</span><span class="o">);</span>

        <span class="n">memberRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">member</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">member</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">validateDuplicatedMember</span><span class="o">(</span><span class="n">Member</span> <span class="n">member</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 중복 회원은 안된다.</span>
        <span class="n">memberRepository</span><span class="o">.</span><span class="na">findByNames</span><span class="o">(</span><span class="n">member</span><span class="o">.</span><span class="na">getName</span><span class="o">())</span>
                <span class="o">.</span><span class="na">ifPresent</span><span class="o">(</span><span class="n">m</span> <span class="o">-&gt;</span> <span class="o">{</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="s">"이미 존재하는 회원입니다."</span><span class="o">);</span>
                <span class="o">});</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Member</span><span class="o">&gt;</span> <span class="nf">findMembers</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">memberRepository</span><span class="o">.</span><span class="na">findAll</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">Member</span><span class="o">&gt;</span> <span class="nf">findOne</span><span class="o">(</span><span class="n">Long</span> <span class="n">memberId</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">memberRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">memberId</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>하지만 Optional을 바로 반환하는 것은 좋지 않다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 중복 회원은 안된다.</span>
<span class="n">memberRepository</span><span class="o">.</span><span class="na">findByNames</span><span class="o">(</span><span class="n">member</span><span class="o">.</span><span class="na">getName</span><span class="o">())</span>
  <span class="o">.</span><span class="na">ifPresent</span><span class="o">(</span><span class="n">m</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="s">"이미 존재하는 회원입니다."</span><span class="o">);</span>
  <span class="o">});</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">ifPresent()</code> 를 사용해 바로 확인.</p>

<ul>
  <li>서비스 클래스는 비즈니스적인 네이밍을 써야한다.</li>
</ul>

<p><strong>그런데 서비스 테스트와 레포지토리 테스트에서 각각의 MemoryMemberRepository 인스턴스를 생성해 테스트하고 있다.</strong><br />
현재는 static으로 선언되어 있지만, 이치에 맞지 않는 현상. <br />
생성자를 통해 외부에서 주입하도록 한다.</p>

<p><strong>생성자 주입(DI)</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@BeforeEach</span>
<span class="kt">void</span> <span class="nf">beforeEach</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">memberRepository</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MemoryMemberRepository</span><span class="o">();</span>
    <span class="n">memberService</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MemberService</span><span class="o">(</span><span class="n">memberRepository</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>각 테스트 실행 전에 호출되며 테스트가 서로 영향 없이 항상 새로운 객체를 생성하고 의존관계도 새로 맺어준다.</p>

<p>Controller 에서 요청을 받고, Service에서 비즈니스 로직을 처리하고, Repository에서 데이터를 저장하고 이게 정형화된 로직이다.</p>

<p>스프링이 관리를 하면 애플리케이션이 포함된 하위 패키지 내에서 스프링이 컴포넌트를 스캔한다.<br />
스프링은 스프링 컨테이너에 스프링 빈을 등록할 때, 기본으로 싱글톤으로 등록한다. (메모리도 절약된다.)</p>

<h2 id="4-스프링-빈과-의존관계">4. 스프링 빈과 의존관계</h2>

<hr />

<h3 id="컴포넌트-스캔과-자동-의존관계-설정">컴포넌트 스캔과 자동 의존관계 설정</h3>

<p>생성자에 <code class="highlighter-rouge">@Autowired</code>가 있으면 스프링이 연관된 객체를 스프링 컨테이너에서 찾아서 넣어준다.<br />
객체 의존 관계를 외부에서 넣어주는 것을 DI라고 한다.</p>

<h4 id="스프링-빈을-등록하는-방법">스프링 빈을 등록하는 방법</h4>

<ul>
  <li>컴포넌트 스캔과 자동 의존관계 설정</li>
  <li>자바 코드로 직접 스프링 빈 등록하기</li>
</ul>

<p><code class="highlighter-rouge">@Component </code> 가 있으면 스프링 빈으로 자동 등록된다. (@Controller, @Service, @Repository). 
생성자에 <code class="highlighter-rouge">@Autowired</code> 를 사용하면 객체 생성 시점에 스프링 컨테이너에서 해당 스프링 빈을 찾아서 주입한다.<br />
생성자가 1개만 있으면 <code class="highlighter-rouge">@Autowired</code> 는 생략 가능하다.</p>

<p>스프링은 스프링 빈을 등록할 때 기본으로 싱글톤으로 등록한다. (유일하게 하나만 등록). <br />
따라서 같은 스프링 빈이면 모두 같은 인스턴스다.</p>

<p><code class="highlighter-rouge">@Autowired</code> 를 통한 DI는 스프링이 관리하는 객체(빈)에서만 동작한다.</p>

<p>DI에는 필드 주입, setter 주입, 생성자 주입 3가지가 있는데, <br />
의존 관계가 동적으로 변하는 경우는 거의 없으므로 생성자 주입을 권장한다.</p>

<h2 id="5-회원-관리-예제---웹-mvc-개발">5. 회원 관리 예제 - 웹 MVC 개발</h2>

<hr />

<p>요청이 올 경우 스프링 컨테이너에서 컨트롤러를 찾고 없으면 static 파일을 찾는다.</p>

<h2 id="6-스프링-db-접근-기술">6. 스프링 DB 접근 기술</h2>

<hr />

<p>jdbc만 사용할 경우 중복이 너무 많으니 spring에서는 jdbc templates를 제공한다.</p>

<p>sql을 다루지 않고, 쿼리 없이 객체를 db에 저장할 수 있다.</p>

<p>jpa를 편리하게 쓸 수 있도록 감싼 것이 스프링 JPA</p>

<h3 id="solid---개방-폐쇄-원칙ocp">SOLID - 개방 폐쇄 원칙(OCP)</h3>

<p>확장에는 열려있고, 수정과 변경에는 닫혀있다.<br />
스프링의 DI를 사용하면 기존 코드는 전혀 손대지 않고, 설정만으로 구현 클래스를 변경할 수 있다.</p>

<h3 id="스프링-통합-테스트">스프링 통합 테스트</h3>

<p>지금까지는 순수 자바 코드만으로 테스트를 진행했는데,<br />
스프링 부트가 모든 정보가 들고 있으니 스프링 컨테이너와 DB까지 연결한 통합 테스트를 진행해야 한다.</p>

<p>스프링 통합 테스트는 DI가 아닌 필드 인젝션을 사용한다.<br />
테스트를 다른데서도 쓰이는 것이 아니라 한 클래스 내에서 사용하고 끝이기 때문이다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SpringBootTest</span>
<span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemberServiceIntegrationTest</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">MemberService</span> <span class="n">memberService</span><span class="o">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">MemberRepository</span> <span class="n">memberRepository</span><span class="o">;</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="err">회원가입</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// given</span>
        <span class="n">Member</span> <span class="n">member</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Member</span><span class="o">();</span>
        <span class="n">member</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"hello"</span><span class="o">);</span>

        <span class="c1">// when</span>
        <span class="n">Long</span> <span class="n">saveId</span> <span class="o">=</span> <span class="n">memberService</span><span class="o">.</span><span class="na">join</span><span class="o">(</span><span class="n">member</span><span class="o">);</span>

        <span class="c1">// then</span>
        <span class="n">Member</span> <span class="n">findMember</span> <span class="o">=</span> <span class="n">memberService</span><span class="o">.</span><span class="na">findOne</span><span class="o">(</span><span class="n">saveId</span><span class="o">).</span><span class="na">get</span><span class="o">();</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">member</span><span class="o">.</span><span class="na">getName</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="n">findMember</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="err">중복회원예외</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">//given</span>
        <span class="n">Member</span> <span class="n">member1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Member</span><span class="o">();</span>
        <span class="n">member1</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"spring"</span><span class="o">);</span>

        <span class="n">Member</span> <span class="n">member2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Member</span><span class="o">();</span>
        <span class="n">member2</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"spring"</span><span class="o">);</span>

        <span class="c1">// when</span>
        <span class="n">memberService</span><span class="o">.</span><span class="na">join</span><span class="o">(</span><span class="n">member1</span><span class="o">);</span>

        <span class="c1">// then</span>
        <span class="n">assertThatThrownBy</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="n">memberService</span><span class="o">.</span><span class="na">join</span><span class="o">(</span><span class="n">member2</span><span class="o">);</span>
        <span class="o">}).</span><span class="na">isInstanceOf</span><span class="o">(</span><span class="n">IllegalArgumentException</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="n">IllegalArgumentException</span> <span class="n">e</span> <span class="o">=</span> <span class="n">assertThrows</span><span class="o">(</span><span class="n">IllegalArgumentException</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">memberService</span><span class="o">.</span><span class="na">join</span><span class="o">(</span><span class="n">member2</span><span class="o">));</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"이미 존재하는 회원입니다."</span><span class="o">)).</span><span class="na">isTrue</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li><code class="highlighter-rouge">@SpringBootTest</code> : 스프링 컨테이너와 테스트를 함께 실행한다.</li>
  <li><code class="highlighter-rouge">@Transactional</code> : 각각의 테스트 시작 전에 트랜잭션을 시작하고, 테스트 완료 후에 항상 롤백한다. 이렇게 하면 DB에 데이터가 남지 않으므로 다음 테스트에 영향을 주지 않는다</li>
  <li><code class="highlighter-rouge">@Commit</code> : 테스트 케이스가 끝나면 커밋한다.</li>
</ul>

<h3 id="jdbc-templates">JDBC Templates</h3>

<p>JDBC Templates를 바로 주입받을 수 없다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nf">JdbcTemplateMemberRepository</span><span class="o">(</span><span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">jdbcTemplate</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JdbcTemplate</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>
<span class="o">}</span>

</code></pre></div></div>

<p>JDBC Template은 템플릿 메서드 패턴이다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">public</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">Member</span><span class="o">&gt;</span> <span class="nf">findById</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Member</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">jdbcTemplate</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="s">"select * from member where id = ?"</span><span class="o">,</span> <span class="n">memberRowMapper</span><span class="o">(),</span> <span class="n">id</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">findAny</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="n">RowMapper</span><span class="o">&lt;</span><span class="n">Member</span><span class="o">&gt;</span> <span class="nf">memberRowMapper</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">return</span> <span class="o">(</span><span class="n">rs</span><span class="o">,</span> <span class="n">rowNum</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="n">Member</span> <span class="n">member</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Member</span><span class="o">();</span>
    <span class="n">member</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getLong</span><span class="o">(</span><span class="s">"id"</span><span class="o">));</span>
    <span class="n">member</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"name"</span><span class="o">));</span>
    <span class="k">return</span> <span class="n">member</span><span class="o">;</span>
  <span class="o">};</span>
<span class="o">}</span>
</code></pre></div></div>

<p>query 수행 결과는 RowMapper로 맵핑을 해주어야 한다.<br />
객체 생성은 RowMapper에서 한다.</p>

<h3 id="jpa">JPA</h3>

<p>기존의 반복 코드는 물론, SQL도 JPA가 직접 만들어서 실행해준다.<br />
SQL과 데이터 중심의 설계에서 객체 중심의 설계로 패러다임을 전환 할 수 있다.<br />
JPA를 사용하면 개발 생산성을 크게 높일 수 있다.<br />
JPA는 객체와 관계형 데이터 베이스를 맵핑하는 ORM이다.</p>

<p><strong>build.gradle</strong></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dependencies {
implementation 'org.springframework.boot:spring-boot-starter-thymeleaf'
implementation 'org.springframework.boot:spring-boot-starter-web'
implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
runtimeOnly 'com.h2database:h2'
testImplementation('org.springframework.boot:spring-boot-starter-test') {
exclude group: 'org.junit.vintage', module: 'junit-vintage-engine'
}
}
</code></pre></div></div>

<p>spring-boot-starter-data-jpa 는 내부에 jdbc 관련 라이브러리를 포함하기 때문에 jdbc는 제거해도 된다.</p>

<p>JPA는 인터페이스다. Hibernate는 이의 구현체이다.</p>

<p><strong>Member</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Member</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">Long</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>데이터의 id를 자동으로 생성해주는 것을 identity 전략이라고 한다.</p>

<p><strong>JpaMemberRepository</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Member</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"select m from Member m"</span><span class="o">,</span> <span class="n">Member</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
            <span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li><code class="highlighter-rouge">"select m from Member m"</code> : jpql이라는 쿼리. 객체를 대상으로 쿼리를 날린다. 자동으로 쿼리문이 된다.</li>
</ul>

<p>JPA를 사용하면 항상 Transaction이 있어야 한다.  서비스 계층에 트랜잭션을 추가한다.<br />
스프링은 해당 클래스의 메서드를 실행할 때 트랜잭션을 시작하고, 메서드가 정상 종료되면 트랜잭션을 커밋한다. 만약 런타임 예외가 발생하면 롤백한다. JPA를 통한 모든 데이터 변경은 트랜잭션 안에서 실행해야 한다.</p>

<h3 id="스프링-data-jpa">스프링 Data JPA</h3>

<p>스프링 부트와 JPA만 사용해도 개발 생산성이 정말 많이 증가하고, 개발해야할 코드도 확연히 준다. <br />
여기에 스프링 데이터 JPA를 사용하면, 리포지토리에 구현 클래스 없이 인터페이스 만으로 개발을 완료할 수 있습니다. <br />
그리고 반복 개발해온 기본 CRUD 기능도 스프링 데이터 JPA가 모두 제공합니다. <br />
따라서 개발자는 핵심 비즈니스 로직을 개발하는데, 집중할 수 있습니다.<br />
실무에서 관계형 데이터베이스를 사용한다면 스프링 데이터 JPA는 이제 선택이 아니라 필수 입니다</p>

<p>스프링 데이터 JPA는 JPA를 편리하게 사용하도록 도와주는 기술이다.</p>

<p>스프링 JPA가 인터페이스에 대한 구현체를 자동으로 만들어낸다.</p>

<p>구현 클래스 작성 필요 없이 인터페이스 이름 만으로도 개발이 가능하다.</p>

<p>실무에서는 JPA와 스프링 데이터 JPA를 기본으로 사용하고, 복잡한 동적 쿼리는 Querydsl이라는 라이브러리를 사용하면 된다. Querydsl을 사용하면 쿼리도 자바 코드로 안전하게 작성할 수 있고, 동적 쿼리도 편리하게 작성할 수 있다. 이 조합으로 해결하기 어려운 쿼리는 JPA가 제공하는 네이티브 쿼리를 사용하거나, 앞서 학습한 스프링 JdbcTemplate를 사용하면 된다.</p>

<h2 id="7-aop">7. AOP</h2>

<hr />

<h4 id="필요한-상황">필요한 상황</h4>

<ul>
  <li>모든 메소드의 호출 시간을 측정하고 싶을 때</li>
  <li>공통 관심 사항 vs 핵심 관심 사항</li>
  <li>회원 가입 시간, 회원 조회 시간을 측정하고 싶을 때</li>
</ul>

<p><strong>메서드 별로 수행 시간을 찍어본다.</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="n">Long</span> <span class="nf">join</span><span class="o">(</span><span class="n">Member</span> <span class="n">member</span><span class="o">)</span> <span class="o">{</span>
   <span class="kt">long</span> <span class="n">start</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
   <span class="k">try</span> <span class="o">{</span>
     <span class="n">validateDuplicateMember</span><span class="o">(</span><span class="n">member</span><span class="o">);</span> <span class="c1">//중복 회원 검증</span>
     <span class="n">memberRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">member</span><span class="o">);</span>
     <span class="k">return</span> <span class="n">member</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
     <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
       <span class="kt">long</span> <span class="n">finish</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
       <span class="kt">long</span> <span class="n">timeMs</span> <span class="o">=</span> <span class="n">finish</span> <span class="o">-</span> <span class="n">start</span><span class="o">;</span>
       <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"join "</span> <span class="o">+</span> <span class="n">timeMs</span> <span class="o">+</span> <span class="s">"ms"</span><span class="o">);</span>
   <span class="o">}</span>
<span class="o">}</span>
<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Member</span><span class="o">&gt;</span> <span class="nf">findMembers</span><span class="o">()</span> <span class="o">{</span>
   <span class="kt">long</span> <span class="n">start</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
   <span class="k">try</span> <span class="o">{</span>
   	 <span class="k">return</span> <span class="n">memberRepository</span><span class="o">.</span><span class="na">findAll</span><span class="o">();</span>
   <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
     <span class="kt">long</span> <span class="n">finish</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
     <span class="kt">long</span> <span class="n">timeMs</span> <span class="o">=</span> <span class="n">finish</span> <span class="o">-</span> <span class="n">start</span><span class="o">;</span>
     <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"findMembers "</span> <span class="o">+</span> <span class="n">timeMs</span> <span class="o">+</span> <span class="s">"ms"</span><span class="o">);</span>
   <span class="o">}</span>
 <span class="o">}</span>
</code></pre></div></div>

<p><strong>문제</strong></p>

<ul>
  <li>회원가입, 회원 조회 시간을 측정하는 기능은 핵심 관심 사항이 아니다.</li>
  <li>시간을 측정하는 로직은 공통 관심 사항이다.</li>
  <li>시간을 측정하는 로직과 핵심 비즈니스의 로직이 섞여서 유지보수가 어렵다.</li>
  <li>시간을 측정하는 로직을 별도의 공통 로직으로 만들기 매우 어렵다.</li>
  <li>시간을 측정하는 로직을 변경할 때 모든 로직을 찾아가면서 변경해야 한다.</li>
</ul>

<h3 id="aop-aspect-oriented-programming-적용">AOP (Aspect Oriented Programming) 적용</h3>

<p>공통 관심 사항과 핵심 관심 사항을 분리한다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Aspect</span>
<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TimeTraceAop</span> <span class="o">{</span>

    <span class="nd">@Around</span><span class="o">(</span><span class="s">"execution(* hello.hellospring..*(..))"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">execute</span><span class="o">(</span><span class="n">ProceedingJoinPoint</span> <span class="n">joinPoint</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Throwable</span> <span class="o">{</span>
        <span class="kt">long</span> <span class="n">start</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"START: "</span> <span class="o">+</span> <span class="n">joinPoint</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">joinPoint</span><span class="o">.</span><span class="na">proceed</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="kt">long</span> <span class="n">finish</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
            <span class="kt">long</span> <span class="n">timeMs</span> <span class="o">=</span> <span class="n">finish</span> <span class="o">-</span> <span class="n">start</span><span class="o">;</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"END: "</span> <span class="o">+</span> <span class="n">joinPoint</span><span class="o">.</span><span class="na">toString</span><span class="o">()</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">timeMs</span> <span class="o">+</span> <span class="s">"ms"</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>회원가입, 회원 조회등 핵심 관심사항과 시간을 측정하는 공통 관심 사항을 분리한다.</li>
  <li>시간을 측정하는 로직을 별도의 공통 로직으로 만들었다.</li>
  <li>핵심 관심 사항을 깔끔하게 유지할 수 있다.</li>
  <li>변경이 필요하면 이 로직만 변경하면 된다.</li>
  <li>원하는 적용 대상을 선택할 수 있다 (@Around(“execution(* hello.hellospring.service.*(..))”))</li>
</ul>

<p>AOP가 있으면 프록시를 만들어 가짜 빈을 만든다.<br />
가짜 빈에서 joinPoint.proceed()가 일어나면 실제 빈을 호출해준다.</p>

<p><img src="https://user-images.githubusercontent.com/43840561/115102809-6ee80480-9f88-11eb-950e-c9d5ac92b6be.png" alt="image" /></p>

<p><img src="https://user-images.githubusercontent.com/43840561/115102816-7dceb700-9f88-11eb-918c-fede0fa4ec8e.png" alt="image" /></p>

<p>콘솔에 출력해보면 실제 MemberService가 아닌 Proxy가 출력되는 것을 볼 수 있다.</p>

<h2 id="참고-자료">참고 자료</h2>

<hr />

<ul>
  <li><a href="https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81-%EC%9E%85%EB%AC%B8-%EC%8A%A4%ED%94%84%EB%A7%81%EB%B6%80%ED%8A%B8/dashboard">스프링 입문 - 코드로 배우는 스프링 부트, 웹 MVC, DB 접근 기술</a></li>
</ul>


	  ]]></description>
	</item>

	<item>
	  <title>📋 프로가 되기 위한 웹기술 입문 4</title>
	  <link>//webbasic4</link>
	  <author></author>
	  <pubDate>2021-04-15T19:18:00+09:00</pubDate>
	  <guid>//webbasic4</guid>
	  <description><![CDATA[
	     <h2 id="4-cgi에서-웹-애플리케이션으로">4. CGI에서 웹 애플리케이션으로</h2>

<hr />

<h3 id="리다이렉트의-구조">리다이렉트의 구조</h3>

<p>상태코드 302일 경우 <code class="highlighter-rouge">Location</code> 헤더에 표시된 URL에 다시 요청을 발행한다.<br />
이처럼 처음 요청한 URL과 다른 URL로 유도하는 것을 <strong>리다이렉트</strong>라고 한다.</p>

<h3 id="상태-유지-프로토콜과-무상태-프로토콜의-차이">상태 유지 프로토콜과 무상태 프로토콜의 차이</h3>

<p>FTP는 서버가 앞선 요청을 기억하는 상태 유지 프로토콜이다.<br />
상태 유지 프로토콜은 통신 절차가 많아 오버헤드가 크다.</p>

<p>HTTP는 상태를 가지 않는 무상태 프로토콜이다.<br />
상태를 유지하지 않을 경우 오버헤드가 적지만 상태를 유지하지 않으니, 로그인 같은 인증에 대한 상태 관리를 하기 어려웠다.</p>

<h3 id="쿠키의-개념과-구현-방법">쿠키의 개념과 구현 방법</h3>

<p>쿠키는 무상태 프로토콜안 HTTP의 규격을 확장해 웹 애플리케이션과 웹 브라우저 사이에서 정보를 교환할 수 있게한다.<br />
요청을 할 때 웹 브라우저의 상태를 <code class="highlighter-rouge">Cookie</code> 라는 헤더에 실어 보낸다.</p>

<h4 id="쿠키의-문제점">쿠키의 문제점</h4>

<p>요청 헤더, 응답 헤더에 쿠키를 설정하기 때문에 보안상의 위협이 있다.</p>

<h3 id="세션의-개념과-구현-방법">세션의 개념과 구현 방법</h3>

<p>세션이란 일련의 처리 흐름을 말한다.<br />
이 처리 흐름이 한 번에 완료 되지 않는다면 세션에 상태를 추가해야 한다.<br />
이러한 세션의 상태는 웹 서버에서 관리하고 세션 ID만을 주고 받는다.<br />
세션 ID는 단순한 숫자(또는 문자열) 이므로 쿠키를 이용해 관리한다.</p>

<p>로그인과 같은 세션을 개시할 때 웹 서버가 새로운 세션 ID를 발행하고, 쿠키에 저장되어 브라우저에 전달된다.<br />
이후 요청부터는 브라우저는 쿠키를 서버에 보내 인증을 성공한다.</p>

<p>쿠키에 세션ID만 저장함으로써 쿠키에 저장할 수 있는 정보량의 제한을 무시할 수 있고, 안정성을 높인다.</p>

<h2 id="5-웹-애플리케이션의-구성-요소">5. 웹 애플리케이션의 구성 요소</h2>

<hr />

<p>웹 애플리케이션은 클라이언트와 서버가 HTTP를 통해 통신함에 따라 구현된다.</p>

<h4 id="-프로그램-vs-애플리케이션-vs-서버-vs-프로세스">➕ 프로그램 VS 애플리케이션 VS 서버 VS 프로세스</h4>

<h5 id="프로그램">프로그램</h5>

<p>컴퓨터가 실행하는 처리의 순서를 지시한 것.<br />
소스코드 자체를 프로그램이라고 할 때도 많다.</p>

<h5 id="애플리케이션">애플리케이션</h5>

<p>워드프로세서, 표 계산 등 컴퓨터 상에서 작동하며, 사용자에게 기능을 제공하기 위한 것. <br />
웹 애플리케이션 또한 웹을 이용해 특정 목적을 달성하기 위한 소프트웨어</p>

<h5 id="서버">서버</h5>

<p>특정 기능을 제공하는 데 특화된 소프트웨어.<br />
단독으로 시스템을 구성하지는 못한다. <br />
애플리케이션을 비롯한 다른 소프트웨어와 조합하여 사용하여야 한다.<br />
서버를 이용하는 것이 클라이언트이다.</p>

<h5 id="프로세스">프로세스</h5>

<p>컴퓨터 상에서 작동하고 있는 소프트웨어</p>

<h3 id="웹-서버">웹 서버</h3>

<h3 id="애플리케이션-서버">애플리케이션 서버</h3>

<h4 id="서블릿이나-jsp는-어디에서-작동하는가">서블릿이나 JSP는 어디에서 작동하는가?</h4>

<p>자바 프로그램은 컴퓨터가 직접 실행하는 것이 아니라 JVM이라는 가상의 컴퓨터가 실행한다.<br />
때문에 JVM도 컴퓨터가 볼 때는 하나의 프로세스로, 웹 서버, 데이터베이스와 마찬가지로 독립된 프로세스로 동작한다.</p>

<p>JVM에서는 애플리케이션 서버라는 소프트웨어가 작동되고, 이 서버가 서블릿이나 JSP를 작동시킨다.<br />
CGI는 웹 서버로 요청이 올 때마다 새로운 프로세스가 기동되었다가 종료되는 1회용 모델이지만,<br />
애플리케이션 서버는 항상 프로세스가 상주해 있고 웹 서버로부터 요청을 받아 서블릿이나 JSP를 실행하는 재사용 모델이다.</p>

<h4 id="웹-서버와-애플리케이션-서버의-연동">웹 서버와 애플리케이션 서버의 연동</h4>

<h4 id="톰캣">톰캣</h4>

<p>아파치에서 개발한 오픈 소스 애플리케이션 서버. <br />
웹 서버와 연동하기 위해 톰캣은 아파치용으로 mode_jk라는 연동 모듈을 제공하며, 아파치 확장 기능으로 탑재해 연동을 구현한다.</p>

<p>아파치에 도착한 HTTP 요청을 mod_jk가 톰캣으로 전송하고, 톰캣이 이 기반에서 작동하는 웹 애플리케이션에 전달한다.<br />
웹 애플리케이션이 처리를 실행하고, 애플리케이션 서버로 결과를 되돌려준다.<br />
애플리케이션 서버는 mod_jk에 결과를 되돌려주고 아파치가 웹 브라우저로 HTTP 응답을 되돌려준다.</p>

<p><img src="https://user-images.githubusercontent.com/43840561/115107234-93ea7080-9fa4-11eb-9799-6535c498c9f9.png" alt="image" /></p>

<p>또한 여러 대의 애플리케이션 서버를 다른 노드에 배치해 분담시킬 수도 있다.</p>

<h4 id="웹-서버와-애플리케이션-서버의-분담">웹 서버와 애플리케이션 서버의 분담</h4>

<ul>
  <li>웹 서버 : 정적인 데이터를 처리한다.</li>
  <li>애플리케이션 서버 : 동적 데이터를 처리한다.</li>
</ul>

<p>이와 같이 서버 사이드에서 프로세스 두개가 연동한다.<br />
클라이언트가 페이지에 따라 요구를 보낼 프로세스가 제각각이면 골치아프니, 클라이언트의 HTTP 요청을 웹 서버가 전부 받고,<br />
애플리케이션 서버가처리해야 할 요청만 웹 서버가 전달한다.</p>

<p>이 두 서버를 분리함으로써<br />
처리는 가벼운 대신 횟수가 많은 정적 콘텐츠에 대한 요청은 웹 서버, <br />
횟수는 적지만 처리량이 무거운 동적 컨텐츠 요청은 애플리케이션으로 분담한다.</p>

<p>사실 대부분의 애플리케이션 서버는 웹 서버 기능도 가지고 있다.</p>

<h3 id="데이터-베이스-서버">데이터 베이스 서버</h3>

<p>대량의 정보를 기록하고 빠르게 검색, 집계할 수 있는 소프트웨어 (Database Management System)</p>

<h4 id="sql">SQL</h4>

<p>Structured Query Language (구조적 질의 언어). <br />
무엇을(SELECT), 어디에서(WHERE), 어떻게(GROUP BY 등) 추출할 것인지 표현하는 작업에 특화되어 있다.</p>

<h4 id="데이터베이스와-클라이언트의-관계">데이터베이스와 클라이언트의 관계</h4>

<p>데이터베이스는 독립적으로 작동하는 프로세스이고, 쿼리를 통해 결과를 취득하는 쪽도 프로세스이다. <br />
웹 애플리케이션에서는 웹 애플리케이션 프로그램이 SQL을 발행한다. <br />
만약 고객이 상품의 리스트를 조회하고 싶을 때 상품 목록을 HTML에 매번 직접 기술하는 것이 아닌,<br />
요청이 들어올 때마다 데이터 베이스에서 목록을 조회해온다.</p>

<h4 id="데이터베이스-서버의-분리">데이터베이스 서버의 분리</h4>

<p>DBMS는 여러 애플리케이션에서 동시에 이용되기 때문에 단독 프로세스로 작동한다.<br />
즉 웹 서버와 데이터베이스 서버는 다른 프로세스로서 작동한다.<br />
일반적으로는 웹 서버를 작동시킬 컴퓨터와 데이터베이스를 작동시킬 컴퓨터를 따로 준비해 각 프로세스를 각 컴퓨터에서 실행한다.<br />
이 경우, 처리가 분산되어 부하가 줄어들며 새로운 시스템이 구축되더라도 여러 클라이언트가 DB 서버를 이용하기 편리해진다.</p>

<h4 id="웹-애플리케이션과-데이터-베이스의-통신">웹 애플리케이션과 데이터 베이스의 통신</h4>

<p>웹 브라우저와 웹 서버가 HTTP를 사용해 통신하듯이,<br />
웹 애플리케이션과 데이터베이스가 통신할 경우에도 고유의 통신 프로토콜을 사용해 통신한다.</p>

<h2 id="6-웹-애플리케이션을-효율적으로-개발하는-방법">6. 웹 애플리케이션을 효율적으로 개발하는 방법</h2>

<hr />

<h3 id="서블릿jsp만으로는-부족한가">서블릿/JSP만으로는 부족한가?</h3>

<h4 id="웹-애플리케이션-대부분에서-자바를-사용하는-이유">웹 애플리케이션 대부분에서 자바를 사용하는 이유</h4>

<ul>
  <li>역사 깊은 언어</li>
  <li>객체지향, 재사용적</li>
  <li>오픈 소스 라이브러리와 프레임워크의 양과 질이 충실</li>
  <li>수많은 개발 지원 도구가 오픈소스로 제공</li>
</ul>

<h4 id="서블릿과-jsp의-연동">서블릿과 JSP의 연동</h4>

<p>서블릿은 HTTP 요청을 받아 브라우저에 되돌려줄 HTML을 자바 프로그램에서 출력할 수 있게 한 것.<br />
JSP는 HTML 속에 자바를 스크립틀릿으로 심을 수 있게 한 것이다. <br />
JSP만을 이용할 경우, 처리가 복잡한 웹 애플리케이션을 만들 때 JSP 안에 기술되는 코드가 늘어나 개발 관리가 힘들어진다.</p>

<p>이 문제를 해결하기 위해 HTML 표시는 JSP가, 애플리케이션에서 처리하는 부분은 서블릿이 담당하게 한다.</p>

<pre><code class="language-web.xml">&lt;!-- 서블릿 정의 --&gt;
&lt;servlet&gt;
	&lt;servlet-name&gt;login&lt;/servlet-name&gt;
	&lt;servlet-class&gt;kr.co.wiki.webtext.pizza.servlet.LoginServlet&lt;/servlet-class&gt;
&lt;/servlet&gt;

&lt;!-- 서블릿 매핑 --&gt;
&lt;servlet-mapping&gt;
	&lt;servlet-name&gt;login&lt;/servlet-name&gt;
	&lt;servlet-pattern&gt;login.do&lt;/servlet-pattern&gt;
&lt;/servlet-mapping&gt;
</code></pre>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">doPost</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">req</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">res</span><span class="o">)</span>
<span class="kd">throws</span> <span class="n">ServletException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>

    <span class="n">String</span> <span class="n">id</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"realname"</span><span class="o">);</span>
    <span class="n">String</span> <span class="n">password</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"mypassword"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<h4 id="포워드-vs-리다이렉트">포워드 vs 리다이렉트</h4>

<p>서블릿에서 JSP로 이동은 브라우저를 통하지 않고 애플리케이션 서버 내에서만 진행된다.<br />
웹 애플리케이션에서는 이와 같은 이동을 포워드라고 하며 리다이렉트와는 구분된다.</p>

<ul>
  <li>리다이렉트 : 상태코드 302를 통해 이동할 URL을 알려주어 클라이언트에서 서버로 다시 요청을 보낸다. (요청이 2번 일어남)</li>
  <li>포워드 : 애플리케이션 서버 내에서만 이동 처리가 진행되어 서버측 처리 결과가 클라이언트로 돌아온다. (요청이 1번 일어남)</li>
</ul>

<h4 id="요청-스코프">요청 스코프</h4>

<p>서블릿과 JSP 사이에서 정보를 공유하기 위한 방식이다.<br />
즉, 포워드 한 곳과 포워드 된 곳 사이에서 정보를 공유하기 위한 방식이다.</p>

<h4 id="요청-매개변수와의-차이">요청 매개변수와의 차이</h4>

<ul>
  <li>요청 매개변수 : HTTP 메서드를 통해 클라이언트에서 웹 애플리케이션에 문자열로 전달된다. 서블릿이나 JSP에서 참조는 할 수 있지만 받은 값은 변경할 수 없다.</li>
  <li>요청 스코프 : 애플리케이션 서버에서 제공된는 구조로, 포워드 전후에 자바 객체를 공유할 수 있다. 하지만 HTTP 요청을 1회 처리하는 동안만 유효하므로 요청 처리가 종료되면 요청 스코프에 담겼던 정보는 사라진다. 즉 리다이렉트에서는 정보를 인계할 수 없다.</li>
</ul>

<h4 id="요청-스코프가-필요한-이유">요청 스코프가 필요한 이유</h4>

<p>세션은 보존한 정보를 언제 해제해야 할지 모른다.<br />
이를 세션 타임아웃으로 해결할 수 있지만 세션은 메모리도 많이 소비하는 단점이 있다.</p>

<h4 id="세션-스코프와-요청-스코프의-차이">세션 스코프와 요청 스코프의 차이</h4>

<table>
  <thead>
    <tr>
      <th style="text-align: center"> </th>
      <th style="text-align: center">세션 스코프</th>
      <th style="text-align: center">요청 스코프</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">유효 범위</td>
      <td style="text-align: center">세션 시작, 종료 또는 타임아웃 될 때까지</td>
      <td style="text-align: center">요청 받은 다음 응답을 돌려줄 때까지</td>
    </tr>
    <tr>
      <td style="text-align: center">시작과 종료</td>
      <td style="text-align: center">웹 애플리케이션이 제어</td>
      <td style="text-align: center">애플리케이션 서버가 제어</td>
    </tr>
    <tr>
      <td style="text-align: center">주된 용도</td>
      <td style="text-align: center">사용자 정보의 보존</td>
      <td style="text-align: center">페이지 이동전후의 보존</td>
    </tr>
  </tbody>
</table>

<h3 id="웹-애플리케이션의-아키텍쳐">웹 애플리케이션의 아키텍쳐</h3>

<p>건축을 할 때 꼼꼼한 설계를 하듯, 소프트웨어도 개발 초기에 전체적인 구조를 철저히 검토해야한다.</p>

<ul>
  <li>아키텍처 : 소프트웨어는 필연적으로 닮은 부분이 나타나는데, 이런 설계 스타일과 설계에 바탕을 둔 전체 구조</li>
</ul>

<h4 id="-자바를-부품화하기-위한-방법---javabeans">➕ 자바를 부품화하기 위한 방법 - JavaBeans</h4>

<p>자바 클래스를 부품화하기 위한 것으로, 웹 애플리케이션에서는 단순히 데이터를 보존하기 위한 클래스 정도의 의미밖에 없다.<br />
웹 애플리케이션의 자바빈즈는 필드에 대응하는 세터와 게터가 존재한다.</p>

<p>애플리케이션의 고유 처리를 비즈니이라고 한다.<br />
비즈니스 로직은 사용자 인터페이스에 영향받지 않고 존재하는 부분이다.<br />
ex) 회원 관리 서비스를 웹 애플리케이션이 아니라 GUI 애플리케이션으로 구현한다면, 화면 구현 방법은 달라지지만 로그인 처리는 같다.</p>

<h3 id="jdbc를-통한-db-접근">JDBC를 통한 DB 접근</h3>

<p>웹 애플리케이션에서 데이터베이스로부터 정보를 얻기 위한 API로 JDBC를 사용한다.</p>

<ul>
  <li>데이터 소스 획득 : 데이텁베이스에 대한 접속을 구하기 위한 객체</li>
  <li>연결 획득</li>
  <li>SQL의 실행</li>
  <li>SQL 실행 결과의 취득</li>
</ul>

<h4 id="jdbc를-사용할-경우-단점">JDBC를 사용할 경우 단점</h4>

<p>단순한 쿼리에도 방대한 코드를 작성해야한다.</p>

<h3 id="mvc--layered-architecture">MVC + Layered Architecture</h3>

<p>Layered Architecture은 시스템을 계층화하고 하위 레이어가 제공하는 기능을 상위 레이어가 이용함으로 각 레이어 구조를 단순화한다.<br />
각 레이어를 먼제 3 계층으로 분리한다.</p>

<ul>
  <li>프레젠테이션 레이어 : 사용자와의 인터페이스를 담당하는 레이어</li>
  <li>비즈니스 로직 레이어 : 애플리케이션에서 구현해야 할 고유의 작업을 처리하기 위한 레이어</li>
  <li>데이터 엑세스 레이어 : 비즈니스 로직 레이어와 데이터베이스를 중개하기 위한 레이어. 비즈니스 로직에서 분리해 데이터베이스 연결 절차를 의식하지 않게 해준다.</li>
</ul>

<p>컨트롤러와 뷰는 프레젠테이션 레이어이며, 모델은 비즈니스 로직 레이어와 데이터 엑세스 레이어가 된다.</p>

<h3 id="dao-패턴을-이용한-데이터-액세스-레이어의-구현">DAO 패턴을 이용한 데이터 액세스 레이어의 구현</h3>

<p>DAO의 역할은 <strong>데이터베이스 접속을 은폐하는 것</strong>이다.</p>

<h3 id="rdb와-객체의-임피던스-불일치">RDB와 객체의 임피던스 불일치</h3>

<p>OR 매핑은 <strong>프로그래밍 언어의 객체와 관계형 데이터베이스를 대응시킨다.</strong><br />
관계형 데이터 베이스는 여러 개의 테이블과 그 관계를 이용해 정보를 관리한다.<br />
객체와 관계형 데이터베이스는 본질적으로는 같은 정보이지만, 표현 방법에는 큰 차이가 있을 수 있다.<br />
이를 <strong>임피던스 불일치</strong>라고 한다.</p>

<p>이런 임피던스 불일치릃 해결해주는 것이 바로 OR 매핑 프레임 워크이다.<br />
(이 밖에도 데이터베이스와의 접속을 관리하거나, 정보를 캐싱해 데이터베이스 접속을 빠르게 하는 등의 기능도 제공힌다.)</p>

<p>아이바티스를 이용하면 SQL이나 테이블의 구성이 변경되더라도 소스코드가 아니라 SQL 앱 파일만 바꾸면 되어 변경하기 쉽다.</p>

<h3 id="프레임워크-이용의-장점과-단점">프레임워크 이용의 장점과 단점</h3>

<h4 id="장점">장점</h4>

<ul>
  <li>설계, 개발 공수의 절감 : 아이바티스는 데이터베이스 연결에 관한 대부분의 처리를 대신 해준다.</li>
  <li>품질 향상</li>
  <li>테스트 공수의 절감</li>
</ul>

<h4 id="단점">단점</h4>

<ul>
  <li>학습 비용의 증대</li>
  <li>설계의 자유도 저하</li>
  <li>장기적인 기술력의 저하</li>
</ul>


	  ]]></description>
	</item>

	<item>
	  <title>📋 프로가 되기 위한 웹기술 입문 1-3</title>
	  <link>//webbasic13</link>
	  <author></author>
	  <pubDate>2021-04-14T19:18:00+09:00</pubDate>
	  <guid>//webbasic13</guid>
	  <description><![CDATA[
	     <h2 id="1-웹-애플리케이션이란-무엇인가">1. 웹 애플리케이션이란 무엇인가?</h2>

<hr />

<table>
  <thead>
    <tr>
      <th style="text-align: center"> </th>
      <th style="text-align: center">데스크톱 애플리케이션</th>
      <th style="text-align: center">웹 애플리케이션</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">처리 주체</td>
      <td style="text-align: center">자신의 PC</td>
      <td style="text-align: center">서버</td>
    </tr>
    <tr>
      <td style="text-align: center">화면 표시</td>
      <td style="text-align: center">운영체제 상에서 표시</td>
      <td style="text-align: center">웹 브라우저에서 표시</td>
    </tr>
    <tr>
      <td style="text-align: center">설치</td>
      <td style="text-align: center">필요</td>
      <td style="text-align: center">불필요</td>
    </tr>
  </tbody>
</table>

<h2 id="2-웹은-어떻게-발전했는가">2. 웹은 어떻게 발전했는가?</h2>

<hr />

<h3 id="www-등장의-배경">WWW 등장의 배경</h3>

<p>이메일이나 파일 전송 기술보다 더 편리하게 정보를 공유하자! <br />
정보를 텍스트파일만으로 표현하게 만드는 것이 HTTP이다. <br />
네트워크 상에서 링크된 하이퍼 링크의 연결을 WWW라고 부르기 시작했다. <br />
WWW에서는 웹 서버가 네트워크 상에 공개하는 하이퍼 텍스트를 축적하고 웹 클라이언트 요청에 따라 필요한 HTML 파일을 건네준다.</p>

<p>텍스트 중심으로 표현되던 웹 페이지를 문자와 그림과 함께 표현할 수 있게 만든 것이 NCSA 모자이크라는 웹 브라우저이다.</p>

<h3 id="웹에서-클라이언트와-서버의-역할-분담">웹에서 클라이언트와 서버의 역할 분담</h3>

<p>다양한 콘텐츠를 불특정 다수에게 공개하려면 콘텐츠를 한 곳에 관리해야한다.<br />
WWW에서는 사람들의 PC를 웹 클라이언트로, 멀리 떨어져 있는 웹 서버와 웹 클라이언트 사이를 인터넷으로 연결한다.</p>

<ul>
  <li>클라이언트 : 웹 클라이언트라는 컴퓨터 상에서 웹 브라우저라는 소프트웨어가 작동</li>
  <li>서버 : 우베 서버라는 컴퓨터 상에서 웹 서버라는 소프트웨어가 작동</li>
</ul>

<h3 id="url의-역할과-구조">URL의 역할과 구조</h3>

<p>콘텐츠를 고유하게 저장하기 위한 구조. <br />
스킴, 호스트명, 경로명으로 구성되어 있다.</p>

<h3 id="http의-역할">HTTP의 역할</h3>

<p>웹서버와 웹 클라이언트가 통신하기 위한 규약.4</p>

<h3 id="cgi-등장의-배경과-역할">CGI 등장의 배경과 역할</h3>

<p>동적인 페이지 요구에 따라 CGI가 등장하고,<br />
웹 서버가 클라이언트로부터 받은 요청을 웹 서버상에서 작동하는 프로그램을 보낸다.</p>

<h3 id="서블릿-등장의-배경">서블릿 등장의 배경</h3>

<p>CGI를 이용한 웹 애플리케이션은 개발 언어의 문제와, 성능 문제를 가지고 있다.<br />
웹 브라우저에서 요청이 도착할 때마다 CGI를 통해 프로세스를 기동하여 성능이 저하되었다.</p>

<p><strong>서블릿은 자바로 만들어진 HTML 등의 웹 콘텐츠를 생성하기 위한 프로그램.</strong><br />
CGI와 같은 개념이지만 콘텐츠를 생성하는 언어가 자바이며 객체지향을 지원하기 떄문에 대규모 애플리케이션 개발에 적합하다.<br />
또한 웹서버와 같은 프로세스 속에서 콘텐츠를 생성하는 프로그램이 작동하기 때문에 CGI 처럼 새로운 프로세스를 매번 기동할 필요가 없다.</p>

<p>자바는 JVM 덕분에 한 프로그램을 운영체제와 상관없이 어디에서나 동작시킬 수 있다.</p>

<p>CGI는 프로세스를 기동시켜 동적 컨텐츠를 만들어내고, 서블릿은 스레드를 실행시킨다.</p>

<p><a href="https://dannykim-5603.tistory.com/75">CGI와 서블릿 그리고 톰캣</a> 다음 글을 참고하자.</p>

<h3 id="jsp-등장의-배경">JSP 등장의 배경</h3>

<p>서블릿을 통해 출력되는 HTML을 상상하기 어려웠다.</p>

<p>JSP는 서블릿과 달리 출력되는 HTML에 거의 근접한 형태이다.<br />
JSP 내부에 적힌 자바 프로그램을 스크립틀릿이라고 한다.</p>

<p><strong>서블릿은 자바 코드에 HTML을 넣고, JSP는 HTML에 자바 코드를 넣는다.</strong></p>

<h3 id="웹-애플리케이션-프레임워크의-필요성">웹 애플리케이션 프레임워크의 필요성</h3>

<p>서블릿이나 JSP 만으로 웹 애플리케이션을 만드려면 코드량이 굉장히 늘어난다.</p>

<p>프레임워크는 재사용할 수 있는 부분을 늘려 애플리케이션 개발을 용이하게 하는 것이다.<br />
이로 인해 애플리케이션을 단기간에 개발할 수 있다.</p>

<h2 id="3-http를-이해하자">3. HTTP를 이해하자</h2>

<hr />

<h3 id="http-요청의-구조">HTTP 요청의 구조</h3>

<p><strong>요청 라인</strong></p>

<ul>
  <li>메서드 : 요청의 종류</li>
  <li>URL : 무엇을 원하는가</li>
  <li>HTTP 버전 : 버전에 따라 이용할 수 있는 메서드의 종류와 요청 헤더의 종류가 달라지므로 어떤 버전에 따른 요청인지 나타냄</li>
</ul>

<p><strong>대표적인 헤더</strong></p>

<ul>
  <li>
    <p>Accept : 웹 클라이언트가 받을 수 있는 데이터의 종류</p>
  </li>
  <li>
    <p>Accept-Language : 웹 클라이언트가 받을 수 있는 자연 언어의 종류</p>
  </li>
  <li>
    <p>User-Agent : 웹 브라우저의 종류와 버전</p>
  </li>
  <li>
    <p>Host : 요청을 보낸 곳의 호스트명과 포트 번호</p>

    <p>HTTP는 한 요청에 한 리소스만 취득할 수 있다.</p>
  </li>
</ul>

<h3 id="http-응답의-구조">HTTP 응답의 구조</h3>

<ul>
  <li>상태라인 : HTTP 버전, 상태 코드, 응답 구분</li>
  <li>메시지 헤더 : 응답에 관한 부가적인 정보</li>
  <li>메시지 본문 : HTML 파일 내용이 그대로 담김</li>
</ul>

<h3 id="ip-주소">IP 주소</h3>

<p>인터넷에 접속된 모든 컴퓨터는 IP 주소라는 숫자로 식별된다.<br />
하지만 인간이 IP 주소를 기억하기에는 어렵다.</p>

<p>IP 주소는 전세계에 하나만 있어야 한다.<br />
이 IP 주소는 대량의 IP 주소를 확보해 놓은 인터넷 서비스 프로바이더(ISP)로부터 할당받는다.</p>

<h3 id="호스트명을-ip-주소로-변환하는-시스템dns">호스트명을 IP 주소로 변환하는 시스템(DNS)</h3>

<p>도메인명과 IP 주소의 대응표를 가진 컴퓨터를 인터넷상에 배치하여 도메인명에 대응하는 IP 주소를 가르쳐준다.<br />
도메인명에 대응하는 DNS 서버는 분산 관리 되고 있다.</p>

<h3 id="get-요청과-post-요청의-차이">GET 요청과 POST 요청의 차이</h3>

<table>
  <thead>
    <tr>
      <th style="text-align: center"> </th>
      <th style="text-align: center">GET</th>
      <th style="text-align: center">POST</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">매개변수 저장 장소</td>
      <td style="text-align: center">URL</td>
      <td style="text-align: center">BODY</td>
    </tr>
    <tr>
      <td style="text-align: center">보안</td>
      <td style="text-align: center">낮음 (URL이 노출됨)</td>
      <td style="text-align: center">비교적 높음 (서버 로그에 남지 않음)</td>
    </tr>
    <tr>
      <td style="text-align: center">매개변수의 길이</td>
      <td style="text-align: center">255 문자 이내로 제한될 가능성</td>
      <td style="text-align: center">제한 없음</td>
    </tr>
    <tr>
      <td style="text-align: center">매개변수의 보존 재현</td>
      <td style="text-align: center">용이</td>
      <td style="text-align: center">어려움</td>
    </tr>
  </tbody>
</table>

<h3 id="퍼센트-인코딩을-이용한-표현">퍼센트 인코딩을 이용한 표현</h3>

<p>한글로 매개변수를 전달할 경우, 문자 코드로 나타낸 16진수 값 각 앞머리에 %를 붙여 표시하는 퍼센트 인코딩을 사용한다.</p>

	  ]]></description>
	</item>

	<item>
	  <title>📖 테스트로 배우는 스프링</title>
	  <link>//til1</link>
	  <author></author>
	  <pubDate>2021-04-13T19:18:00+09:00</pubDate>
	  <guid>//til1</guid>
	  <description><![CDATA[
	     <h4 id="스프링을-왜-배울까-">스프링을 왜 배울까 ?</h4>

<p>잘 동작하는 웹 애플리케이션을 만들기 위해</p>

<h4 id="웹-애플리케이션이란-">웹 애플리케이션이란 ?</h4>

<p>웹 기반으로 동작하는 애플리케이션 -&gt; 웹 기능이 필요하다.<br />
웹을 활용하려면 네트워크가 필요하다 근데 직접 구현하려면 너무 방대해진다.<br />
그래서 프레임 워크를 활용해야한다.</p>

<h4 id="프레임워크-">프레임워크 ?</h4>

<p>구현해놓고 재사용한다.<br />
프레임워크가 있으면 비즈니스 로직만 구현하면 서비스가 만들어진다.</p>

<hr />

<h2 id="테스트로-배우는-스프링">테스트로 배우는 스프링</h2>

<p>왜 테스트로 스프링을 배울까. <br />
테스트는 기능을 익히기 위한 수단이다.</p>

<h2 id="1-초간단-스프링-프로젝트">1. 초간단 스프링 프로젝트</h2>

<h3 id="resourcesschemasql">resources/schema.sql</h3>

<p>Spring의 기본 값으로 ClassPath 루트에 <strong>schema.sql, data,sql</strong>이 있다면 서버 시작 시 실행될 SQL 문을 미리 정의할 수 있다.</p>

<ul>
  <li><strong>schema.sql</strong> : DDL</li>
  <li><strong>data.sql</strong> : DML</li>
</ul>

<p>개발 단계에서는 in-memory-db인 h2를 기본으로 사용하므로, 굳이 물리적인 DB를 연결하지 않아도 DB 작업이 가능하다.</p>

<h3 id="restcontroller">@RestController</h3>

<p><strong>@Controller와 @ResponseBody</strong>를 합쳐 놓은 어노테이션이다.<br />
메소드마다 @ResponseBody를 붙여주지 않아도 된다.</p>

<h4 id="controller와의-차이">@Controller와의 차이?</h4>

<p>@Controller는 주로 View를 반환하기 위해 사용한다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Client가 요청을 보냄 
-&gt; DispatcherServlet과 Handler Mapping이 요청을 인터셉트 
-&gt; Controller에 의해 요청을 처리하고, DispatcherServlet이 Model과 View를 적절히 Client에 반환
</code></pre></div></div>

<p>View를 반환하기 위해서는 ViewResolver가 사용되며, ViewResolver 설정에 맞게 View를 찾아 렌더링한다.<br />
여기서, <strong>@ResponseBody</strong> 를 사용할 경우 자바 객체를 HTTP 응답의 Body의 내용(Json)으로 매핑을 한다. <br />
이럴경우 ViewResolver 대신 HttpMessageConverter가 동작한다.<br />
HttpMessageConverter에는 여러 Converter가 등록되어 있는데, 반환 타입에 따라 사용되는 Converter가 달라진다.</p>

<h4 id="restcontroller는">@RestController는…</h4>

<p>@RestController는 REST 요청에 대한 응답을 줄 때 사용하며, Json 형태로 객체 데이터를 반환한다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Client가 요청을 보냄 
-&gt; DispatcherServlet과 Handler Mapping이 요청을 인터셉트 
-&gt; RestController에 의해 요청을 처리하고, 데이터 반환
</code></pre></div></div>

<h3 id="repository">@Repository</h3>

<p>퍼시스턴스 레이어, 영속성을 가지는 속성.<br />
DB나 파일같은 외부 I/O 작업을 처리한다.
@Repository, @Service, @Controller는 특정한 기능에 대한 @Component의 구체화된 형태이다.</p>

<hr />

<h2 id="2-spring-mvc">2. Spring MVC</h2>

<h3 id="request-mapping">Request Mapping</h3>

<p>URL, HTTP method, request parameters, headers, media types에 대한 맵핑을 할 수 있다.</p>

<ul>
  <li><code class="highlighter-rouge">@GetMapping</code></li>
  <li><code class="highlighter-rouge">@PostMapping</code></li>
  <li><code class="highlighter-rouge">@PutMapping</code></li>
  <li><code class="highlighter-rouge">@DeleteMapping</code></li>
  <li><code class="highlighter-rouge">@PatchMapping</code></li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/http-method/users"</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;&gt;</span> <span class="nf">showUser</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">users</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
    <span class="k">new</span> <span class="nf">User</span><span class="o">(</span><span class="s">"이름"</span><span class="o">,</span> <span class="s">"email"</span><span class="o">),</span>
    <span class="k">new</span> <span class="nf">User</span><span class="o">(</span><span class="s">"이름"</span><span class="o">,</span> <span class="s">"email"</span><span class="o">)</span>
  <span class="o">);</span>
  <span class="k">return</span> <span class="n">ResponseEntity</span><span class="o">.</span><span class="na">ok</span><span class="o">().</span><span class="na">body</span><span class="o">(</span><span class="n">users</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="uri-patterns">URI patterns</h3>

<ul>
  <li><code class="highlighter-rouge">"/resources/ima?e.png"</code> -path 세그먼트에서 한 문자 일치</li>
  <li><code class="highlighter-rouge">"/resources/*.png"</code> -path 세그먼트에서 0 개 이상의 문자와 일치</li>
  <li><code class="highlighter-rouge">"/resources/**"</code> -여러 path 세그먼트 일치</li>
  <li><code class="highlighter-rouge">"/projects/{project}/versions"</code> -path 세그먼트를 일치시키고 변수로 캡처</li>
  <li><code class="highlighter-rouge">"/projects/{project:[a-z]+}/versions"</code> -정규식과 일치하고 변수를 캡처</li>
</ul>

<h3 id="producible-media-types">Producible Media Types</h3>

<p>수신 하고자하는 데이터 포맷을 정의.  <br />
요청에 ‘Accept’ Header가 produces에 명시한 MediaType과 일치해야 요청이 매칭된다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/users"</span><span class="o">,</span> <span class="n">produces</span> <span class="o">=</span> <span class="n">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON_VALUE</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;&gt;</span> <span class="nf">showUser</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">users</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
    <span class="k">new</span> <span class="nf">User</span><span class="o">(</span><span class="s">"이름"</span><span class="o">,</span> <span class="s">"email"</span><span class="o">),</span>
    <span class="k">new</span> <span class="nf">User</span><span class="o">(</span><span class="s">"이름"</span><span class="o">,</span> <span class="s">"email"</span><span class="o">)</span>
  <span class="o">);</span>
  <span class="k">return</span> <span class="n">ResponseEntity</span><span class="o">.</span><span class="na">ok</span><span class="o">().</span><span class="na">body</span><span class="o">(</span><span class="n">users</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="consumable-media-types">Consumable Media Types</h3>

<p>출력하고자 하는 데이터 포맷을 정의.   <br />
Content-Type 요청 헤더가 consumes에 명시한 MediaType과 일치해야 요청이 매칭된다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@PostMapping</span><span class="o">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">"/users"</span><span class="o">,</span> <span class="n">consumes</span> <span class="o">=</span> <span class="n">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON_VALUE</span><span class="o">)</span> 
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">addUser</span><span class="o">(</span><span class="nd">@RequestBody</span> <span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// ...</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="parameters-headers">Parameters, headers</h3>

<p>요청 매핑의 범위를 좁힌다.</p>

<p><strong>특정 param</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/message"</span><span class="o">,</span> <span class="n">params</span> <span class="o">=</span> <span class="s">"name"</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">messageForParam</span><span class="o">(</span><span class="nd">@RequestParam</span> <span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">ResponseEntity</span><span class="o">.</span><span class="na">ok</span><span class="o">().</span><span class="na">body</span><span class="o">(</span><span class="s">"hello"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>Header 조건</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/message"</span><span class="o">,</span> <span class="n">headers</span> <span class="o">=</span> <span class="s">"HEADER=hi"</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">messageForHeader</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">ResponseEntity</span><span class="o">.</span><span class="na">ok</span><span class="o">().</span><span class="na">body</span><span class="o">(</span><span class="s">"hi"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="method-arguments">Method Arguments</h3>

<p>컨트롤러의 메서드 인수.</p>

<p><strong>@RequestParam</strong></p>

<p>http://127.0.0.1/users?name=amazzi 와 같은 요청 처리.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/users"</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;&gt;</span> <span class="nf">requestParam</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"name"</span><span class="o">)</span> <span class="n">String</span> <span class="n">userName</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">users</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span>
    <span class="k">new</span> <span class="nf">User</span><span class="o">(</span><span class="n">userName</span><span class="o">,</span> <span class="s">"email"</span><span class="o">),</span>
    <span class="k">new</span> <span class="nf">User</span><span class="o">(</span><span class="n">userName</span><span class="o">,</span> <span class="s">"email"</span><span class="o">)</span>
  <span class="o">);</span>
  <span class="k">return</span> <span class="n">ResponseEntity</span><span class="o">.</span><span class="na">ok</span><span class="o">().</span><span class="na">body</span><span class="o">(</span><span class="n">users</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">value</code> 옵션을 주어 파라미터 명이 name인 것을 userName에 할당.</p>

<p><strong>@PathVariable</strong></p>

<p>http://127.0.0.1/users/1 와 같은 요청 처리.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/users/{id}"</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">pathVariable</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="n">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="n">User</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="s">"이름"</span><span class="o">,</span> <span class="s">"email"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">ResponseEntity</span><span class="o">.</span><span class="na">ok</span><span class="o">().</span><span class="na">body</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>@RequestParam</strong>, <strong>@PathVariable</strong> 이 둘을 복합적으로 사용하기도 한다.</p>

<p><strong>@RequestBody</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@PostMapping</span><span class="o">(</span><span class="s">"/users/body"</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">ResponseEntity</span> <span class="nf">requestBody</span><span class="o">(</span><span class="nd">@RequestBody</span> <span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">User</span> <span class="n">newUser</span> <span class="o">=</span> <span class="k">new</span> <span class="n">User</span><span class="o">(</span><span class="mi">1L</span><span class="o">,</span> <span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="n">user</span><span class="o">.</span><span class="na">getEmail</span><span class="o">());</span>
  <span class="k">return</span> <span class="n">ResponseEntity</span><span class="o">.</span><span class="na">created</span><span class="o">(</span><span class="n">URI</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"/users/"</span> <span class="o">+</span> <span class="n">newUser</span><span class="o">.</span><span class="na">getId</span><span class="o">())).</span><span class="na">body</span><span class="o">(</span><span class="n">newUser</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">HttpMessageConverter</code>구현 을 사용하여 선언 된 메서드 인수 형식으로 변환.</p>

<h3 id="return-values">Return Values</h3>

<h4 id="string">String</h4>

<p>Spring + View template을 사용할 때 흔히 사용하는 타입.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/users"</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">users</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"data"</span><span class="o">,</span> <span class="n">data</span><span class="o">);</span>
    <span class="k">return</span> <span class="s">"/users/data"</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>모델에 데이터를 Map으로 담고 반환 타입을 String으로 뷰 이름을 지정하면 뷰로 데이터가 전송된다.</p>

<h4 id="void">void</h4>

<p>스프링에서는 뷰 이름을 지정해주지 않아도 URL을 보고 자동으로 뷰 네임을 지정해주기도 한다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/user/address"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">void</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"user"</span><span class="o">,</span> <span class="n">data</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<h4 id="responsebody">@ResponseBody</h4>

<p>Json 형태로 데이터를 반환한다.<br />
객체를 반환타입으로 지정할 경우 클라이언트는 객체의 Json 형태의 데이터를 받는다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/message"</span><span class="o">)</span>
<span class="nd">@ResponseBody</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">string</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">"message"</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/users"</span><span class="o">)</span>
<span class="nd">@ResponseBody</span>
<span class="kd">public</span> <span class="n">User</span> <span class="nf">responseBodyForUser</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">User</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="s">"email"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/users/{id}"</span><span class="o">)</span>
<span class="nd">@ResponseBody</span>
<span class="kd">public</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">responseEntity</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="n">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">ResponseEntity</span><span class="o">.</span><span class="na">ok</span><span class="o">(</span><span class="k">new</span> <span class="n">User</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="s">"email"</span><span class="o">));</span>
<span class="o">}</span>
</code></pre></div></div>

<p>전체 응답 (HTTP 헤더 및 본문 포함)을 지정하는 반환 값은 <code class="highlighter-rouge">HttpMessageConverter</code>구현을 통해 변환.</p>

<h3 id="exceptions">Exceptions</h3>

<p><strong>@Controller</strong>및 <strong>@ControllerAdvice</strong> 를 가진 클래스는 컨트롤러 메서드의 예외를 처리하는 메서드를 가질 수 있다 .</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/exceptions"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExceptionsController</span> <span class="o">{</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/hello"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">ResponseEntity</span> <span class="nf">exceptionHandler</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">CustomException</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/hi"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">ResponseEntity</span> <span class="nf">exceptionHandler2</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">HelloException</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="n">CustomException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">handle</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">ResponseEntity</span><span class="o">.</span><span class="na">badRequest</span><span class="o">().</span><span class="na">body</span><span class="o">(</span><span class="s">"CustomException"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>클래스 내 정의한 <strong>@ExceptionHandler</strong>는 해당 컨트롤러에서만 사용이 가능하다.<br />
<strong>전역적인 예외 처리</strong>는 아래와 같이 클래스를 하나 만들고 <strong>@ControllerAdvice</strong> 를 선언한다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@ControllerAdvice</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloAdvice</span> <span class="o">{</span>
    <span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="n">HelloException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">handle</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">ResponseEntity</span><span class="o">.</span><span class="na">badRequest</span><span class="o">().</span><span class="na">body</span><span class="o">(</span><span class="s">"HelloException"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="참고자료">참고자료</h3>

<p><a href="https://ooeunz.tistory.com/101">[Spring] Spring MVC: Controller return 타입</a></p>


	  ]]></description>
	</item>

	<item>
	  <title>💡 Level 1를 돌아봅니다</title>
	  <link>//level1</link>
	  <author></author>
	  <pubDate>2021-04-12T19:18:00+09:00</pubDate>
	  <guid>//level1</guid>
	  <description><![CDATA[
	     <p>일단 raw하게 적어보는 Level 1 회고 🙃</p>

<h3 id="미라클-모닝">미라클 모닝</h3>

<p>레벨 1의 나의 생활을 이야기하라하면 미라클 모닝을 빼놓을 수 없다.<br />
나름 포부를 가지고 시작했던 미라클 모닝은 레벨 1 마무리까지 잘 지켜졌다.<br />
<del>사실 방학 동안은 여행을 가면서 쉬기도 했고, 이게 긴장이 풀어져서 그런지 잠이 몰려와서 늦잠도 많이 자긴했지만 ㅎ</del> <br />
교육장 퇴근 후 집에 들어와서 오랫동안 다시 공부를 하기 보다 적당히하고 일찍 잔 후 리프레쉬된 상태로 학습하는 패턴이 내게 가장 베스트인 것 같다.   <br />
특히 페어 프로그래밍을 진행할 때는 페어와 만나기 전, 나의 공부를 할 시간을 확보할 수 있었던 점이 정말 좋았다.   <br />
레벨 1 중후반 부터는 크루 몇명이 함께 아침 일찍 와서 각자 할 일을 했는데, 함께 하니 더 좋았다.</p>

<p>후반부에는 체력 관리를 잘 못해서 아침 시간에 힘든 정신으로 버텼던거같아 조금 아쉬움이 남는다. <br />
또 아침에 무엇을 할지를 명확히 정해놓지 않으니 준비만 하다가 붕 뜬 시간도 꽤 있는 것 같다.</p>

<p>미라클 모닝을 하면서 좀 더 부지런한 삶을 살겠다는 마음가짐을 하는데는 큰 도움이 되었던 것 같다.<br />
시간의 효율도 좋고, 아침의 분위기가 좋아서 매일 아침을 기다리게 된다.<br />
<strong>레벨 2때도 이를 이어가겠지만, 밑에도 쓰듯 체력관리를 잘 하면서 병행해야겠다.</strong></p>

<h3 id="체력-관리">체력 관리</h3>

<p>사실 나는 내 체력을 믿고 있었다.<br />
엄마가 계속해서 영양제 챙겨 먹으라고 일러줬었다.<br />
챙겨 먹기도 귀찮고, 버틸만 한데 괜한데 돈을 쓰는 것 같아서 말을 듣지 않고 있었다.<br />
그러다 체스 미션 때인가, 정말 해야할 일들이 폭풍처럼 몰아치면서 시간에 쫓기는 삶을 살았다.<br />
잠을 줄이게 되고, 그러다 보니 체력도 엄청 떨어져서 하루의 효율이 엄청나게 떨어졌다.<br />
사실 이 전까지는 체력이 크게 중요하지 않다고 생각했는데, 결국 엄마 말대로 영양제를 챙겨 먹기 시작했다.<br />
체력이 떨어지니까 모든 방면에서 효율이 떨어지는 것 같았다.</p>

<p>또 우테코 시작 전에는 매일 아침 일어나서 꼭 플랭크를 했었는데, 근 두달 동안 잊고 지냈다. <br />
우테코 시작하고 내가 한 운동이라곤 걷기 뿐인 것 같다.<br />
사실 그렇게 오래 걸리지도 않는 일인데 나는 왜 바쁘다는 핑계로 하지 않으려 했을까. <br />
레벨 2때는 아침에 일어나서 플랭크하기를 다시 실천할 것이다.</p>

<h3 id="삶의-균형">삶의 균형</h3>

<p>방학 때 한 템포 떨어져서, 나의 삶을 돌아보니 우테코 교육에만 올인하다보니 내가 삶의 균형을 맞추지 못하고 있구나를 깨달았다. <br />
삶의 균형이라는게 여러가지 방면인데 먼저 스스로의 삶에 대한 회고를 해보자면, 스스로를 잘 보살피지 못했던 것 같다.<br />
열심히 해야겠다는 약간의 강박때문에 스스로로의 휴식을 일부러 피했던 두달이었다.<br />
쉬는 것에 죄책감을 느껴서 계속 바쁘게 살려고 했다. <br />
그러다보니 스스로의 감정이나 건강을 보살피지 못했다.</p>

<p>또한 전반적인 나의 삶에서 (교육에 몰입하는 것은 좋지만) 이 때문에 내가 그때 그때 챙기지 못한 것들이 너무 많다.<br />
우테코가 시작되고 바쁘다는 핑계로 친구들의 연락도 멀리하고, 내 체력 관리도 버리고, 스스로를 보살피지도 못하고…<br />
여러 방면의 책임에 있어서 충실하지 못했다.  <br />
물론 내가 어떤 삶을 살고있는지 대부분이 이해해주었기 때문에 트러블은 없었지만, 돌이켜 보니 주변에 미안함이 많았던 두달이었다.<br />
그 때는 어땠는지 모르지만 지나고 보니 내가 조금 더 열의를 냈다면 챙길 수 있는 부분들이었는데 하는 아쉬움이 있다.</p>

<p>방학 때 쉬면서 그동안 신경쓰지 못했던 친구들을 만나고, 쉼을 누리다 보니 지금 24살의 나의 삶도 있었구나를 느꼈다.<br />
레벨 2때는 아침에 일어나서 적어도 30분 정도는 나만의 시간을 가지려 한다.<br />
나를 돌아보고, 내가 챙기지 못한 부분은 없는지 돌아봐야지.</p>

<p>10개월이라는 긴 기간을 끊임 없이 달리기 위해서 무리하지 않고 또 가끔은 내가 달리고 있는 현재의 풍경도 돌아볼 필요가 있다.</p>

<h3 id="성장">성장</h3>

<p>헐래벌떡 지나간 이 두달동안 나는 얼마나 성장했을까.<br />
이 질문을 던지고 블로그를 이사하면서 내가 이 두달동안 썼던 블로그 글들을 보았다.<br />
정말 아무것도 몰랐었구나.<br />
일급 컬렉션, 불변 객체, 함수형 인터페이스 등등… <br />
지금은 알고 있는 것들이 내가 원래 알고 있던 것들이 아니라 나의 노력에 의해 쌓여가고 있었구나를 느낄 수 있었다.<br />
블로그 이사를 하면서 내가 정말 많이 배우고 성장했구나를 느꼈다.</p>

<p>블로그도 엄청 열심히 썼었는데, 바쁜 미션을 진행하느라 내가 배운 내용을 그때 그때 정리하지 못했다.<br />
레벨 2때는 TIL 처럼 간단히라도 오늘 내가 뭘 배웠는지 정리해야겠다.</p>

<p>또한 기술적인 부분에만 성장이 아니라 나의 자신감도 한 층 성장했다.<br />
내가 밥먹듯이 쓰는 내용인 것 같지만, 우테코 초반과 지금의 나를 비교해보면 나는 정말 당당한 사람이 되었다. <br />
물론 완벽하지는 않고 가끔 주눅들 때가 있지만 🥲<br />
주변 크루를 경쟁자가 아닌 동료로 바라보고, 모르는 것을 그럴수 있다고 여기니 스스로가 부끄럽지 않았다.<br />
차차 자신감을 얻어가고, 또 크루들과 한 이슈에 대해 토론하거나 학습 로그 발표를 하면서, 나의 지식을 말하는 스킬도 조금씩 늘고 있다.</p>

<h3 id="크루">크루</h3>

<p>오프라인이 시작되면서 많은 크루들을 만나게 되었다.<br />
교육장 내에서 오고 가는 크루들이랑 이야기하면서 새로운 사람의 이야기를 듣게 된다.<br />
다양한 사람들이랑 이야기 해보는 것은 정말 즐거운 일인 것 같다. <br />
또 오프라인이 시작되면서 데일리 크루들이랑 더 많은 시간을 보낼 수 있어 정말 좋았다.<br />
한가지 아쉬운 것은 모든 데일리 크루들이랑 골고루 시간을 보내지 못했던 것이지만, <br />
마지막 즈음에 같이 밥먹지 않았던 크루들을 찾아 같이 식사를 한 것도 정말 좋았다.<br />
또 방학 때는 데일리 크루 몇명과 제주도를 갔는데, 가서 제주 풍경은 그렇게 많이 즐기지 못했으나,<br />
사람들의 진솔한 이야기를 들을 수 있어서 너무 뜻깊었다.<br />
여행을 즐기기보다는 사람과 더 많은 시간을 보냈지만 오히려 좋았다 !</p>

<h3 id="학습-계획">학습 계획</h3>

<p>마지막 체스 미션 때는 새롭게 배워야할 내용, 해야할 과제들이 너무 많아서 사실 쫓기듯 살았다.<br />
7주차 회고에도 한번 썼는데, 이 때 내가 선택과 집중을 조금만 더 잘했더라면 하는 아쉬움이 있다.<br />
레벨 2때는 내가 학습해야할 내용들에 대한 계획을 세우고 차근차근 선택과 집중을 해나가야지.</p>

<h3 id="페어-프로그래밍">페어 프로그래밍</h3>

<p>레벨 1 동안 총 4번의 페어프로그램을 진행했다.<br />
페어 프로그래밍을 진행하면서 사람들과 소통하는 법을 배우고 있다.<br />
요즘은 단순히 사람과 소통하는 법이 아니라 개발자와 협력하는 법을 배우게 되는 것 같다.<br />
브라운과의 면담에서 얻은 깨달음이 있는데, 미션의 목적을 완성이 아니라 이를 통해 얻을 수 있는 부수적인 성장들을 누리라고 하셨다. <br />
이후로 페어와 미션이 끝나면 서로 회고를 통해 발전할 수 있는 방향을 찾으려고 노력하고 있다.<br />
페어프로그래밍은 정말 실력과 소프트웨어 스킬을 기르는데 정말 효율적인 학습법인 것 같다.</p>

<p>페어프로그래밍 덕분에 누군가에게 나의 의견을 제대로 설명하는 연습을 하고있다. <br />
서로의 의견이 다를 때 내가 왜 이렇게 생각하는지, 내가 아는 지식은 무엇인지를 강제로 말해야 한다.<br />
처음에는 어버버 거렸는데, 이제는 익숙해져서 조금 자신감도 붙었다.<br />
아직 완벽하지 않지만 많이 성장하고 있다.</p>

<p>레벨 1동안의 모든 페어 프로그래밍은 난 만족스럽다 ! (페어도 그러겠지ㅎ?)<br />
페어들과 미션을 즐겁게 진행하면서 서로에게 많이 배우고, 나의 부족함을 알게 해주었다.</p>

<p>레벨 2때의 다짐을 더 적어보자면, 정말 찐한 회고를 통해 폭풍 성장을 이루는 것이다.</p>

	  ]]></description>
	</item>

	<item>
	  <title>🕹 Level 1. 체스 미션 정리 - Service Layer, DAO와 Repository</title>
	  <link>//Level-1.-%EC%B2%B4%EC%8A%A4-%EB%AF%B8%EC%85%98-%EC%A0%95%EB%A6%AC-Service-Layer,-DAO%EC%99%80-Repository</link>
	  <author></author>
	  <pubDate>2021-04-10T19:18:00+09:00</pubDate>
	  <guid>//Level-1.-%EC%B2%B4%EC%8A%A4-%EB%AF%B8%EC%85%98-%EC%A0%95%EB%A6%AC-Service-Layer,-DAO%EC%99%80-Repository</guid>
	  <description><![CDATA[
	     <h2 id="mvc와-service">MVC와 Service</h2>

<p>이번 미션에서 DB를  적용하면서 MVC 패턴에 추가로 Service 레이어를 도입하였다.<br />
또한 DAO와 데이터 전달을 위한 DTO를 처음 사용했는데, DTO를 정리하고 DAO에 대해서도 새롭게 배운 부분이 많아 정리 ✍️</p>

<p><img src="https://user-images.githubusercontent.com/43840561/114273538-6017c400-9a55-11eb-8ad4-3a62eb905948.png" alt="image" style="zoom:50%;" /></p>

<p>휴의 코멘트에 답변을 달다가 나의 코멘트 내용을 정정해주면서 같이 주신 참고자료가 있는데,<br />
<strong>서비스 계층과 비즈니스 로직</strong>이라는 개념이 다르다는 것을 제대로 인지하지 못하고 있었던 것 같다.</p>

<p>때문에 <a href="https://umbum.dev/1066">휴가 주신 MVC 패턴과 Service 레이어에 관한 글</a>을 읽고 간단히 정리해본다. <br />
<em>각 계층에 대한 개념은 조금씩 상이하니 일단 블로그 글은 서비스 계측과 비즈니스 로직에 대한</em>
<em>참고 정도만 한 수준에서 정리하고 다음 레벨에서 상세히 잡아가는 것이 좋겠다고 하셨다.</em></p>

<h3 id="layered-architecture">Layered Architecture</h3>

<p><img src="https://herbertograca.files.wordpress.com/2017/07/2010s-layered-architecture.png?w=640" alt="Layered Architecture – @hgraca" style="zoom: 67%;" /></p>

<p>일반적으로 사용하는 레이어를 구분한다면 위와 같이 나눌 수 있다.  MVC 패턴 또한 이 Layer를 잘 분리하기 위해 존재한다.</p>

<h4 id="layer-분리의-장점-">Layer 분리의 장점 ?</h4>

<ul>
  <li>각 계층이 애플리케이션 내에서 특정 역할만을 수행하게 나눔으로, 비즈니스 요청을 충족하기 위해 수행해야하는 작업에 대한 추상화를 이룬다.<br />
추상화가 잘 이루어진다면 서로 연결되어 있는 계층들이 독립적으로 계층에서 부품을 갈아끼우듯 변경할 수 있다.</li>
  <li>각 계층은 하위 계층에만 종속되고 상위 계층으로는 독립적으로 구성함으로, 위에서 아래로 떨어지는 간단한 구조로 만든다.<br />
이로써 각 Layer를 넘나들면서 꼬여있는 의존 관계를 만들지 않는다.</li>
</ul>

<h4 id="application-layer--service-layer">Application Layer (= Service Layer)</h4>

<p>도메인 모델을 묶어서 소프트웨어에서 사용 가능한 핵심 작업의 집합을 설정하는 계층이다.<br />
보통 도메인 모델 하나만으로는 소프트웨어에서 처리하고자 하는 복잡한 작업을 할 수 없다.<br />
때문에 여러 도메인 모델을 불러와 가공하고 비즈니스 로직을 호출해야하는데 이런 작업을 해주는 Layer가 필요하다.<br />
여기서 <strong>여러 비즈니스 로직들을 의미있는 수준으로 묶어서 추상화하는 것</strong>이 바로 Application Layer이다. <br />
만약 별도의 캡슐화가 필요하지 않은 경우에는 도메인 모델 그대로를 이 서비스로 만들 수 있다.</p>

<p><strong>❓ 추상화가 필요한 이유</strong> <br />
만약 UI, Gateway 같은 내부의 서비스 등 다양한 인터페이스로부터 작업을 요청 받는다면, <br />
각 인터페이스의 종류와 목적이 다르더라도 이를 통해 공통적으로 사용하는 작업이 있을 것이다.<br />
이 공통적인 작업이 각각에서 정의할 경우 중복이 발생하는데, 이를  Service Layer에서 인터페이스로 정의하여 중복을 제거한다.<br />
즉, <strong>핵심적인 API를 제공하는 계층</strong>이라고 할 수 있다.<br />
중요한 것은 Service Layer는 추상화 계층으로 두고, 핵심 로직은 Business Layer에 두는 것이 옳다.</p>

<h4 id="business-layer-domain-model">Business Layer (Domain Model)</h4>

<p>데이터와 이에 관련된 비즈니스 로직인 메서드를 가지고 있는 객체이다.<br />
Model 객체가 단순히 필드와 게터, 세터만을 가지고 있으면 DTO와 다를 것이 없다. (안티패턴)<br />
즉, 도메인 모델에서 해당 데이터에 대한 비즈니스 로직을 가지고 있어야 한다.</p>

<hr />

<h2 id="dao">DAO</h2>

<p>미션이 merge된 후, 미처 질문하지 못한 것이 있어 휴에게 DM으로 질문을 남겼다.<br />
현재 나의 로직에서는 chessGame 객체를 만들기 위해서 piece가 필요한데, 
chessgame 테이블과 piece 테이블 각각에서 쿼리를 날려 데이터를 받아오고<br />
이를 service에서 조합해(?) chessGame 객체를 만들고 있었다.</p>

<p><img src="https://user-images.githubusercontent.com/43840561/114275347-32cf1400-9a5d-11eb-8961-2bca4de75df5.png" alt="image" /></p>

<p>하지만 사실 쿼리를 다음과 같이 join을 사용해서 chessGame 객체를 만들기 위한 데이터를 얻어올 수 있었다.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">turn</span><span class="p">,</span> <span class="n">isFinish</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="k">position</span> <span class="k">FROM</span> <span class="n">chess_game</span> <span class="n">cg</span> <span class="k">inner</span> <span class="k">join</span> <span class="n">piece</span> <span class="n">p</span> <span class="k">WHERE</span> <span class="n">cg</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">chessGameId</span><span class="p">;</span>
</code></pre></div></div>

<p>사실 이렇게 join을 통해서 얻어오려 했지만, dao를 테이블 별로 만들었더니 이 쿼리를 어디서 수행해야할지 판단할 수 없었다. <br />
만약 chessGameDao에서 수행한다 하더라도 여기서piece 객체를 만드는 것도 아이러니하다고 생각도 들었다. <br />
때문에 이렇게 DB에서 받은 결과를 어디에서 조합해야하는가에 대한 질문을 남겼다.<br />
휴의 답변으로 Repository에 대한 것이 언급되었는데,<br />
사실 이 질문 전에도 크루들과 Repository가 도대체 무엇인가에 대해서 토론했었다.<br />
휴의 답변과 보내주신 참고 링크 덕분에 Repository가 어떤 역할을 하는 것인지 명확히 파악할 수 있었다.</p>

<blockquote>
  <p><a href="http://egloos.zum.com/aeternum/v/1160846">DAO와 REPOSITORY 논쟁</a></p>
</blockquote>

<h3 id="dao와-reposotory의-차이점">DAO와 Reposotory의 차이점</h3>

<h4 id="dao-1">DAO</h4>

<ul>
  <li>DAO 인터페이스는 DB의 CRUD 쿼리와 1:1 매칭되는 세밀한 단위의 오퍼레이션을 제공한다.</li>
  <li>테이블 별로 하나의 DAO를 만든다.</li>
  <li>RANSACTION SCRIPT 패턴과 함께 사용된다.</li>
  <li>Persistence Layer에 속한다.</li>
</ul>

<h4 id="repository">Repository</h4>

<ul>
  <li>Repository는 다수의 DAO를 호출하는 방식으로 구성된다.</li>
  <li>Repository에서 제공하는 한 오퍼레이션이 DAO의 여러 오퍼레이션에 맵핑되는 것이 일반적이다.</li>
  <li>DOMAIN MDOEL 패턴과 함께 사용된다.</li>
  <li>Domain Layer에 속한다.</li>
  <li>객체 컬렉션 처리에 관한 책임만을 가지고 있다. 외부 시스템과의 상호작용은 별도의 Service가 담당한다.</li>
</ul>

<p>따라서 현재 나의 질문 같은 경우는 <strong>Repository</strong>를 통해 ChessGameDao와 PieceDao로부터<br />
가져온 <strong>데이터에 대한 집합 처리</strong>를 함으로 해결할 수 있다. <br />
이 둘의 차이에 대해서는 지금 단계에서 이정도로 잡고 가자 !</p>


	  ]]></description>
	</item>

	<item>
	  <title>🕹 Level 1. 체스 미션 정리 - JDBC</title>
	  <link>//Level-1.-%EC%B2%B4%EC%8A%A4-%EB%AF%B8%EC%85%98-%EC%A0%95%EB%A6%AC-JDBC</link>
	  <author></author>
	  <pubDate>2021-04-10T19:18:00+09:00</pubDate>
	  <guid>//Level-1.-%EC%B2%B4%EC%8A%A4-%EB%AF%B8%EC%85%98-%EC%A0%95%EB%A6%AC-JDBC</guid>
	  <description><![CDATA[
	     <h2 id="jdbc-java-database-connectivity">JDBC (Java DataBase Connectivity)</h2>

<p><img src="https://images.velog.io/images/new_wisdom/post/b50e0a8b-eed6-46bd-912e-bd975a37d2de/image.png" alt="" /></p>

<p>JDBC는 DB에 접근할 수 있도록 Java에서 제공하는 API로, 모든 Java의 Data Access 기술의 근간이다.<br />
모든 Persistence Framework는 내부적으로 JDBC API를 이용한다.</p>

<h3 id="jdbc를-통한-db-연결">JDBC를 통한 DB 연결</h3>

<p><img src="https://images.velog.io/images/new_wisdom/post/1d634167-9324-4c86-abdb-023383bb3af8/image.png" alt="" /></p>

<h4 id="1-드라이버-로드">1. 드라이버 로드</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">try</span> <span class="o">{</span>
  <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"com.mysql.cj.jdbc.Driver"</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">ClassNotFoundException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">" !! JDBC Driver load 오류: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
  <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p>제공되는 클래스를 인스턴스화해서 내부적으로 저장해 메모리에 드라이버를 사용할 수 있게한다.<br />
이 메소드를 통해 드라이버를 사용할 수 있도록 초기화 한다. <br />
생성자를 통한 인스턴스 생성과 같다고 볼 수 있다.</p>

<h4 id="2-connection-객체-생성">2. Connection 객체 생성</h4>

<p>DriverManager 클래스는 드라이버를 통해 Conection 객체를 만든다.<br />
Connection은 DB와 연결하는 객체로 DB와 연결하는 통로이며, 이를 통해 쿼리를 전달하고 결과값을 반환받는다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">try</span> <span class="o">{</span>
  <span class="n">con</span> <span class="o">=</span> <span class="n">DriverManager</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(</span><span class="s">"jdbc:mysql://"</span> <span class="o">+</span> <span class="n">server</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">database</span> <span class="o">+</span> <span class="n">option</span><span class="o">,</span> <span class="n">userName</span><span class="o">,</span> <span class="n">password</span><span class="o">);</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"정상적으로 연결되었습니다."</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"연결 오류:"</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
  <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<h4 id="3-statement--preparedstatement-객체-생성">3. Statement / PreparedStatement 객체 생성</h4>

<p><strong>Statement</strong> 객체를 통해 insert 쿼리를 작성하면 아래와 같이 각각의 값을 콤마와 따옴표로 구별해야하기 때문에<br />
가독성도 떨어지고 잘못 입력할 확률도 커진다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">statement</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="na">createStatement</span><span class="o">();</span>
<span class="n">String</span> <span class="n">query</span> <span class="o">=</span> <span class="s">"INSERT INTO piece(color, name, position, chessGameId) VALUE ('"</span> <span class="o">+</span> <span class="n">color</span> <span class="o">+</span> <span class="s">"','"</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span>  <span class="s">"','"</span> <span class="o">+</span> <span class="n">position</span> <span class="o">+</span> <span class="s">"','"</span> <span class="o">+</span> <span class="n">chessGameId</span> <span class="s">"')"</span><span class="o">;</span>
<span class="n">resultCount</span> <span class="o">=</span> <span class="n">statement</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">(</span><span class="n">insertQuery</span><span class="o">);</span>
</code></pre></div></div>

<p><strong>PreparedStatement</strong> 객체를 사용하면 다음과 같이 속성 값을 ?로 설정하고 set을 통해 설정하면, 자동으로 쿼리를 완성시켜준다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">String</span> <span class="n">query</span> <span class="o">=</span> <span class="s">"INSERT INTO piece(color, name, position, chessGameId) VALUE (?, ?, ?, ?)"</span><span class="o">;</span>
<span class="k">try</span> <span class="o">(</span><span class="n">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">dbManager</span><span class="o">.</span><span class="na">getConnection</span><span class="o">();</span>
     <span class="n">PreparedStatement</span> <span class="n">pstmt</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">query</span><span class="o">))</span> <span class="o">{</span>
  <span class="k">for</span> <span class="o">(</span><span class="n">Piece</span> <span class="n">piece</span> <span class="o">:</span> <span class="n">pieces</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">pstmt</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">piece</span><span class="o">.</span><span class="na">color</span><span class="o">().</span><span class="na">name</span><span class="o">());</span>
    <span class="n">pstmt</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">piece</span><span class="o">.</span><span class="na">name</span><span class="o">());</span>
    <span class="n">pstmt</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="n">piece</span><span class="o">.</span><span class="na">position</span><span class="o">().</span><span class="na">key</span><span class="o">());</span>
    <span class="n">pstmt</span><span class="o">.</span><span class="na">setInt</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="n">chessGameId</span><span class="o">);</span>
    <span class="n">pstmt</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li><code class="highlighter-rouge">executeQuery()</code> : select를 통한 정보를 조회하고, 쿼리를 전송 후 결과 객체 반환한다.</li>
  <li><code class="highlighter-rouge">executeUpdate(String query)</code> : Insert, Update, Delete 쿼리를 전송하고 변경된 레코드 수를 반환한다.</li>
</ul>

<h4 id="4-resultset-객체-반환">4. ResultSet 객체 반환</h4>

<p>ResultSet 객체는 select 쿼리의 결과값을 모두 가지고 있는 객체이다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">while</span> <span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">next</span><span class="o">())</span> <span class="o">{</span>
                <span class="n">Piece</span> <span class="n">piece</span> <span class="o">=</span> <span class="n">PieceFactory</span><span class="o">.</span><span class="na">findByInfo</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"color"</span><span class="o">),</span>
                        <span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"name"</span><span class="o">),</span> <span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"position"</span><span class="o">));</span>
                <span class="n">pieces</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">piece</span><span class="o">);</span>
            <span class="o">}</span>
</code></pre></div></div>

<ul>
  <li><code class="highlighter-rouge">boolean next()</code> : 결과 레코드가 존재하면 true, 없으면 false</li>
  <li><code class="highlighter-rouge">boolean previous()</code> : 이전 레코드로 이동 (가장 첫 행이면 false)</li>
  <li><code class="highlighter-rouge">boolean first()</code> : 처음 위치로 이동 (레코드가 없으면 false)</li>
  <li><code class="highlighter-rouge">boolean last()</code> : 마지막 위치로 이동 (레코드가 없으면 false)</li>
  <li><code class="highlighter-rouge">String getString(String colLabel)</code> : 현재 커서 위치의 컬럼명에 해당하는 문자열 반환</li>
  <li><code class="highlighter-rouge">int getInt(String colLabel)</code> :  현재 커서 위치의 컬럼명에 해당하는 정수값 반환</li>
  <li><code class="highlighter-rouge">String getString(int colIndex)</code> : 컬럼 인덱스에 해당하는 문자열 반환 (1부터 시작)</li>
  <li><code class="highlighter-rouge">int getInt(int colIndex)</code> : 컬럼 인텍스에 해당하는 정수값 반환 (1부터 시작)</li>
</ul>

<h4 id="5-자원-해제">5. 자원 해제</h4>

<p>DB 관련 작업을 하면서 <strong>Connection, Statement / PreparedStatement, ResultSet</strong> 객체를 사용했다.<br />
DB 관련 처리 작업이 완료되었다면, 사용했던 객체들을 메모리에서 해제해주어야 한다.<br />
만약 해당 자원들을 해제해주지 않으면 다음과 같은 문제점이 발생할 수 있다.</p>

<ul>
  <li>Connection pool을 사용하지 않은 상태에서 Connection을 닫지 않으면 DBMS에 연결된 새로운 Connection을 생성할 수 없다.</li>
  <li>Statement / PreparedStatement를 해제하지 않으면, 생성된 갯수가 증가하면서 더 이상 새로운 Statement / PreparedStatement를 생성할 수 없다.</li>
</ul>

<p>이번 미션에서는 <strong>try-with-resource</strong>를 통해 자원 close 처리 개선을 하였다.
이는 try 블록의 소괄호 안에서 자원 해제가 필요한 객체를 할당하면 try catch 절이 종료되면서 <br />
자원 해제가 필요한 connection과 preparedstatement를 자동으로 close되는 try-catch 문이다.<br />
preparedstatement를 해제하면 현재(가장 최근에 생성한) ResultSet도 자동으로 해제된다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Piece</span><span class="o">&gt;</span> <span class="nf">findAllByChessGameId</span><span class="o">(</span><span class="kt">int</span> <span class="n">chessGameId</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">Piece</span><span class="o">&gt;</span> <span class="n">pieces</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
  <span class="n">String</span> <span class="n">query</span> <span class="o">=</span> <span class="s">"SELECT color, name, position FROM piece WHERE chessGameId = ?"</span><span class="o">;</span>
  <span class="k">try</span> <span class="o">(</span><span class="n">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">dbManager</span><span class="o">.</span><span class="na">getConnection</span><span class="o">();</span>
       <span class="n">PreparedStatement</span> <span class="n">pstmt</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">query</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">pstmt</span><span class="o">.</span><span class="na">setInt</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">chessGameId</span><span class="o">);</span>
    <span class="n">ResultSet</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">pstmt</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">();</span>

    <span class="k">while</span> <span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">next</span><span class="o">())</span> <span class="o">{</span>
      <span class="n">Piece</span> <span class="n">piece</span> <span class="o">=</span> <span class="n">PieceFactory</span><span class="o">.</span><span class="na">findByInfo</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"color"</span><span class="o">),</span>
                                            <span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"name"</span><span class="o">),</span> <span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"position"</span><span class="o">));</span>
      <span class="n">pieces</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">piece</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="n">pieces</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="sql-exception에-대하여">SQL Exception에 대하여</h3>

<p><img src="https://user-images.githubusercontent.com/43840561/114271267-8173b280-9a4b-11eb-926a-88e6447a527d.png" alt="image" style="zoom:50%;" /></p>

<p>checked exception인 SQLException에 대해 어떻게 처리를 할지 고민하다가 결국 외부로 던져주기만 했었다.<br />
휴의 피드백대로 지금은 DAO에서 stacktrace만 출력하도록 변경하였다. <br />
추후에 휴가 SQLException에 대한 참고 자료를 보내주셨다.</p>

<p>[<a href="http://wonwoo.ml/index.php/post/878">Toby spring] 사라진 SQLException</a>에 따르면 DAO에서 발생하는 예외를 계속해서 외부로 던져주는 것도 하나의 방법이지만,<br />
이렇게 되면 예외가 발생한 DAO를 사용한 Service에서 왜 SQLException이 발생했는지 알 수 없기 때문에 <br />
아래와 같이 SQLException을 포장한 예외의 의미를 담은 커스텀 예외를 만들어 던져주는 것도 하나의 방법이 될 수 있다.  <br />
이렇게 되면 의미가 분명한 예외로 전달해서 처리할 수 있게 된다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">try</span> <span class="o">{</span>
  <span class="c1">//...</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="nf">DuplicatePieceIdException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
<span class="o">}</span>

<span class="k">try</span> <span class="o">{</span>
  <span class="c1">//...</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="nf">DuplicatePieceIdException</span><span class="o">().</span><span class="na">initCause</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>또 자료에 따르면 JDBCTemplate을 사용하면 이 내부에서 SQLException을 처리해준다고 하니 차차 개념을 알아가자.</p>

<h3 id="참고-자료">참고 자료</h3>

<ul>
  <li><a href="https://codevang.tistory.com/205">JDBC를 이용한 DB작업_DB 연동 및 데이터 작업 2/3</a></li>
  <li><a href="https://javacan.tistory.com/entry/78">개발자의 실수를 줄여주는 java.sql.Connection 만들기</a></li>
</ul>

	  ]]></description>
	</item>

	<item>
	  <title>🕹 Level 1. 체스 미션 정리 - DTO</title>
	  <link>//Level-1.-%EC%B2%B4%EC%8A%A4-%EB%AF%B8%EC%85%98-%EC%A0%95%EB%A6%AC-DTO</link>
	  <author></author>
	  <pubDate>2021-04-09T19:18:00+09:00</pubDate>
	  <guid>//Level-1.-%EC%B2%B4%EC%8A%A4-%EB%AF%B8%EC%85%98-%EC%A0%95%EB%A6%AC-DTO</guid>
	  <description><![CDATA[
	     <p>이번 체스 미션에서는 웹 적용을 하면서 새롭게 배운 개념들이 너무 많았다.<br />
때문에 이번 미션을 진행하면서 새로 배운 개념들과, 휴가 주신 피드백을 정리하는 방안으로 기록해야겠다 ✍️</p>

<h2 id="step1에서의-dto">step1에서의 DTO</h2>

<p><img src="https://user-images.githubusercontent.com/43840561/114128924-72e8a680-9938-11eb-920c-449d58edf7a8.png" alt="image" style="zoom:50%;" /></p>

<p>사실 DTO의 개념은 대략 알고 있으나,<br />
전 미션까지는 DTO의 필요성을 잘 못느끼고 있어서 사용하지는 않았었다.<br />
이때 같은 경우는 현재 기물들을 나타내는 Pices 객체들만이 존재할 뿐인데 View에서는 64개의 position에 대한 정보를 출력하기 위해 <br />
Pieces의 메소드를 통해<code class="highlighter-rouge">pieces.findByPosition(CACHE.get(xy));</code> 로 도메인에 대한 의존성이 생기고 있었다.<br />
그래서 이를 제거하기 위해 휴의 리뷰대로 DTO를 만들어 View에 필요한 데이터들을 전달해주기로 하고<br />
이 방법에 대한 확신을 얻기 위해 휴에게 질문을 했었다.<br />
하지만 질답을 하다가 이번 단계에서 DTO를 사용하는 것 보다 다음 단계 웹 UI를 적용하면서<br />
DTO의 필요성을 뼈저리게 느끼기로 했다. <br />
사실 지금 시점에서 돌이켜보면 piecesDto를 만들면 해결될 일인것 같지만, 말씀대로 꼭 DTO가 필요했던 시점이 아니였던 것 같다.<br />
일단 휴와의 질답을 통해 얻은 DTO에 관한 이야기는 다음과 같다.</p>

<ul>
  <li>DTO는 데이터를 전송하기 위한 객체로서 로직이 없어야 한다.<br />
대신 model -&gt; modelDto로 변환하는 과정에서 필요한 작업을 모두 수행하여 View에 필요한 데이터를 세팅할 수 있다.</li>
  <li>DTO의 데이터를 사용할 때 로직을 수행하는게 아닌 생성 하는 시점에 미리 데이터를 다 세팅하고 DTO를 사용하는 시점엔 데이터로서만 사용한다. 
(이 부분이 dto 생성자에서 필요한 값 세팅을 마친다는 의미)</li>
  <li>값에 대한 표현을 어떻게 할지에 대한 ui 로직은 View에서 자체적으로 판단해도 된다.</li>
</ul>

<p>또한 DTO를 적용하기 전 DTO에 관해 알아보고 약간의 정리를 했다.</p>

<hr />

<h3 id="-dto-vs-vo-간단-정리">📝 DTO vs VO 간단 정리</h3>

<h4 id="dto-vo-혼동의-이유">DTO VO 혼동의 이유</h4>

<p>데이터 전달용 객체를 VO에서 TO로 변경되었기 때문에 혼동이 온다.</p>

<h4 id="dto--data-transfer-object">DTO = Data Transfer Object</h4>

<p>“계층 간” 데이터를 전달하기 위한 객체로, 데이터를 담아서 전달하는 바구니 역할을 한다.</p>

<ul>
  <li>용도 : 레이어 간 데이터 전달</li>
  <li>동등 결정 : 속성 값이 모두 같다고 해서 같은 객체는 아니다.</li>
  <li>가변 / 불변 : setter 존재 시 가변, setter 비 존재 시 불변</li>
  <li>로직 : getter / setter 외의 로직을 가지지 않는다.</li>
</ul>

<p>getter/setter 메서드만을 갖는다. <br />
보내는 쪽에서 setter를 사용해 값을 설정하고 getter를 사용해 값을 받는다.</p>

<p>setter 메소드를 가질 경우 데이터가 가변이기 때문에 필드를 final 로 하고 생성자를 통해 set을 하면 더 안정적이다.</p>

<h4 id="-entity">➕ Entity</h4>

<p>엔티티 클래스는 요청이나 응답 값을 전달하는 클래스가 아닌 데이터베이스와 매핑된 핵심 클래스다.<br />
이 엔티티 클래스를 기준으로 테이블이 생성된다. <br />
뷰와 엔티티가 직접 연결되어 있으면 엔티티에 변경이 일어날 때, 뷰의 모든 부분을 수정해주어야 한다.</p>

<h4 id="vo--value-object">VO = Value Object</h4>

<p>값 그 자체를 표현하는 객체로 불변이어야 한다.</p>

<p>값으로만 비교되는 객체로 equals / hashCode 오버라이딩이 핵심이다. <br />
생성자를 통해서만 값을 초기화해야 한다.</p>

<ul>
  <li>용도 : 값 자체 표현</li>
  <li>속성 값이 모두 같으면 같은 객체</li>
  <li>가변 / 불변 : 불변</li>
  <li>로직 : getter / setter 외의 로직을 가질 수 있다.</li>
</ul>

<hr />

<h2 id="step2에서의-dto">step2에서의 DTO</h2>

<h3 id="view에-데이터를-전달하는-목적">View에 데이터를 전달하는 목적</h3>

<p>4, 5단계를 진행하면서 웹 UI를 그리기 위해 Gson을 사용하였고, 이로 뷰에 보내줄 데이터를 Json으로 만들 수 있었다.<br />
<code class="highlighter-rouge">String chessGameListJson = gson.toJson(chessGameList);</code> <br />
이렇게 Gson 객체를 통해 string 형태의 json을 만들고 spark java에서 다음과 같이 res 객체의 body에 이 json을 담아 보낸다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">get</span><span class="o">(</span><span class="s">"/chess-game-list"</span><span class="o">,</span> <span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">res</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">chessGameList</span> <span class="o">=</span> <span class="n">chessService</span><span class="o">.</span><span class="na">getAllChessGameId</span><span class="o">();</span>
  <span class="k">return</span> <span class="n">gson</span><span class="o">.</span><span class="na">toJson</span><span class="o">(</span><span class="n">chessGameList</span><span class="o">);</span>
<span class="o">});</span>
</code></pre></div></div>

<p>➕ 잠깐 Gson에 대해 좀 더 언급하면, <br />
json의 키 값과 객체의 필드를 매칭 시키면 다음과 같이 req로 날아온 json 데이터를 객체로 쉽게 생성할 수 있다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">MoveRequestDto</span> <span class="n">moveRequestDto</span> <span class="o">=</span> <span class="n">gson</span><span class="o">.</span><span class="na">fromJson</span><span class="o">(</span><span class="n">req</span><span class="o">.</span><span class="na">body</span><span class="o">(),</span> <span class="n">MoveRequestDto</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</code></pre></div></div>

<p>Gson을 통해서 객체를 json으로 변경할 때에 gson이 객체의 필드에 있는 값들을 자동으로 key-value의 json으로 만들어 준다.<br />
그런데, 객체 자체를 Gson을 통해 json으로 만들면<br />
View에서 원하는 데이터 양식을 맞출 수 없고, 또 View에서 원하지 않는 데이터도 함께 들어가게 된다.</p>

<p>그래서 이때 필요한 것이 바로 DTO 였다.<br />
View에 필요한 데이터를 원시값 필드로 가진 DTO를 만들고 View에게 데이터 전송을 위해 이를 사용하는 것이다.<br />
이 경험 덕분에 휴가 step1에서 언급했던 DTO의 찐 필요성을 느낄 수 있었다.</p>

<h3 id="dao에서-잘못된-dto-사용">DAO에서 잘못된 DTO 사용</h3>

<p>DTO에 대한 개념을 살펴보면서 <strong>계층 간 데이터를 전달하기 위한 객체</strong>라는 사실에 집중하여 <br />
맨 처음에는 DAO와 Service 레이어가 주고 받는 데이터에서도 DTO를 사용하였었다. <br />
이에 대해서는 다음과 같은 피드백을 받았다.</p>

<p><img src="https://user-images.githubusercontent.com/43840561/114265815-dd2f4300-9a2d-11eb-919e-40acacb82a98.png" alt="image" style="zoom:50%;" /></p>

<p>dao로 데이터를 전달하기 위해 서비스에서 dto로 싸고, dao에서 dto로 반환하여 서비스 레이어에서 꺼내 쓰는 이 과정이,<br />
돌이켜보니 도메인에서 꺼내 쓸 수 있는 값들을 굳이 dto로 전달하면서 불필요한 dto 객체 생성과 코드만 늘어나고 있었다.<br />
뷰에서는 gson을 사용해 json으로 만들기 위해 dto의 필요성을 절실히 느낄 수 있었지만,
 dao에서 불필요한 dto들을 제거했더니 dto를 불필요하게 사용하고 있었구나를 느꼈다.</p>

<h3 id="데이터-전달-목적">데이터 전달 목적</h3>

<p><img src="https://user-images.githubusercontent.com/43840561/114266098-51b6b180-9a2f-11eb-89ca-721d3c9804cd.png" alt="image" style="zoom:50%;" /></p>

<p><img src="https://user-images.githubusercontent.com/43840561/114266117-7448ca80-9a2f-11eb-965d-dbc7e76d3681.png" alt="image" style="zoom:50%;" /></p>

<p>휴의 말대로 나의 구조에서, ChessGame 객체와 chess_game 테이블 간의 불일치는 명확히 존재했다.<br />
사실 DB 연동 경험이 있지만 이번 미션에서 DB를 연동하는데 왜이렇게 막막할까 많이 고민이 되었는데,<br />
객체를 테이블로 1:1 맵핑을 하려하다 보니 생긴 문제였다.<br />
(휴의 말대로 나중에는 ORM을 통해 해결이 되겠지..!) <br />
이번 단계에서는 객체와 테이블 간의 불일 치 문제를 DTO로 해결할 것을 제시해주셨고,<br />
ChessGame에 대해서는 DAO와 Service 간에 데이터 전달에서 DTO를 사용하여 저장할 데이터를 주고 받도록 하였다.</p>

<ul>
  <li><strong>ChessGameDao 일부</strong></li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="n">ChessGameStatusDto</span> <span class="nf">findChessGameStateById</span><span class="o">(</span><span class="kt">int</span> <span class="n">chessGameId</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">String</span> <span class="n">query</span> <span class="o">=</span> <span class="s">"SELECT turn, IF(isFinish, 'true', 'false') isFinish FROM chess_game WHERE id = ?"</span><span class="o">;</span>
  <span class="k">try</span> <span class="o">(</span><span class="n">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">dbManager</span><span class="o">.</span><span class="na">getConnection</span><span class="o">();</span>
       <span class="n">PreparedStatement</span> <span class="n">pstmt</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">query</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">pstmt</span><span class="o">.</span><span class="na">setInt</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">chessGameId</span><span class="o">);</span>
    <span class="n">ResultSet</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">pstmt</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(!</span><span class="n">rs</span><span class="o">.</span><span class="na">next</span><span class="o">())</span> <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">ChessGameStatusDto</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"turn"</span><span class="o">),</span> <span class="n">rs</span><span class="o">.</span><span class="na">getBoolean</span><span class="o">(</span><span class="s">"isFinish"</span><span class="o">));</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li><strong>ChessService 일부</strong></li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="n">ChessGame</span> <span class="nf">findChessGameById</span><span class="o">(</span><span class="kt">int</span> <span class="n">chessGameId</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">ChessGameStatusDto</span> <span class="n">chessGameStatusDto</span> <span class="o">=</span> <span class="n">chessGameDao</span><span class="o">.</span><span class="na">findChessGameStateById</span><span class="o">(</span><span class="n">chessGameId</span><span class="o">);</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">Piece</span><span class="o">&gt;</span> <span class="n">pieces</span> <span class="o">=</span> <span class="n">pieceDao</span><span class="o">.</span><span class="na">findAllByChessGameId</span><span class="o">(</span><span class="n">chessGameId</span><span class="o">);</span>
  <span class="k">return</span> <span class="n">ChessGameFactory</span><span class="o">.</span><span class="na">loadChessGameByInfo</span><span class="o">(</span><span class="n">pieces</span><span class="o">,</span> <span class="n">chessGameStatusDto</span><span class="o">.</span><span class="na">getTurn</span><span class="o">(),</span> <span class="n">chessGameStatusDto</span><span class="o">.</span><span class="na">isFinish</span><span class="o">());</span>
<span class="o">}</span>

</code></pre></div></div>

<p><em>이에 대한 휴의 피드백은 OK 였지만 DTO에 대해서 리뷰어마다 다른 관점을 가지고 있을 것이라 하였다.</em></p>

<hr />

<h2 id="dto에-대한-결론">DTO에 대한 결론</h2>

<p>DTO에 대해서 휴가 주신 참고 자료를 읽고, 이번 미션에서 경험한 DTO를 간략히 정리하고 마무리한다.</p>

<blockquote>
  <p><a href="https://www.slipp.net/questions/22">혹시 DTO(VO) 작성하시나요?</a></p>
</blockquote>

<p>객체를 자동으로 Json으로 변경할 경우 객체에 존재하는 모든 속성과 조합 관계에 있는 객체의 속성까지 Json으로 자동으로 변환된다.<br />
이 경우 View에서 불필요한 속성까지 Json으로 변환된다.<br />
이 문제를 해결하기 위해서 객체에서 View에서 필요한 속성만을 뽑아서 DTO로 만들어 계층 간 데이터를 전달한다.</p>

<p><em>하지만 도메인에서 특정 속성만을 뽑아 데이터를 전달하고 싶다면, 추후에 Lombok을 통해 필요한 속성만을 전달할 수 있다.</em></p>

	  ]]></description>
	</item>


</channel>
</rss>
