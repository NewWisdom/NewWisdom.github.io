<!DOCTYPE html>
<html>
<head>
    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Page Meta -->
    <title>📚 atdd-subway-map 미션 정리</title>
    <meta name="description" content="블로그 이사중... 아직 정리가 안되었음..." />

    <!-- Mobile Meta -->
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Brand icon -->
    <link rel="shortcut icon" href="/assets/images/favicon.ico" >

    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />
    <link rel="stylesheet" type="text/css" href="/assets/css/syntax.css" />
    <link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&family=Roboto:wght@100&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.gstatic.com">
<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&display=swap" rel="stylesheet">
<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans&display=swap" rel="stylesheet">
<link href="http://cdn.jsdelivr.net/gh/joungkyun/font-d2coding/d2coding.css" rel="stylesheet" type="text/css">
<!--Syntax Highlighter-->
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js"></script>
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/androidstudio.min.css">
<style type='text/css'>
    pre, code {
        white-space: pre;
        overflow-x: scroll;
    }
    .hljs
{
    white-space: pre;
    overflow-x: auto;
}
</style>
<script>hljs.initHighlightingOnLoad();</script>
    <!-- Ghost outputs important style and meta data with this tag -->
        <link rel="canonical" href="http://localhost:4000//atdd-subway-path-note" />
    <meta name="referrer" content="origin" />
    <link rel="next" href="/page2/" />

    <meta property="og:site_name" content="Welcome To New Wisdom's Log !" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="📚 atdd-subway-map 미션 정리" />
    <meta property="og:description" content="블로그 이사중... 아직 정리가 안되었음..." />
    <meta property="og:url" content="http://localhost:4000//atdd-subway-path-note" />
    <meta property="og:image" content="/assets/images/woowa.jpg" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="📚 atdd-subway-map 미션 정리" />
    <meta name="twitter:description" content="블로그 이사중... 아직 정리가 안되었음..." />
    <meta name="twitter:url" content="http://localhost:4000//atdd-subway-path-note" />
    <meta name="twitter:image:src" content="/assets/images/woowa.jpg" />

    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Website",
    "publisher": "Welcome To New Wisdom's Log !",
    "name": "📚 atdd-subway-map 미션 정리",
    "url": "http://localhost:4000//atdd-subway-path-note",
    "image": "/assets/images/woowa.jpg",
    "description": "블로그 이사중... 아직 정리가 안되었음..."
}
    </script>

    <meta name="generator" content="Jekyll 3.0.0" />
    <link rel="alternate" type="application/rss+xml" title="Welcome To New Wisdom's Log !" href="/feed.xml" />


</head>
<body class="home-template nav-closed">

    <!-- The blog navigation links -->
    <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        <li class="nav-home " role="presentation"><a href="/">Home</a></li>
        <li class="nav-about " role="presentation"><a href="/about">About</a></li>
        <li class="nav-woowa " role="presentation"><a href="/tag/woowa">WoowaCource</a></li>
        <li class="nav-techotalk " role="presentation"><a href="/tag/techotalk">Techotalk</a></li>
        <li class="nav-java " role="presentation"><a href="/tag/java">Java</a></li>
        <li class="nav-kotlin " role="presentation"><a href="/tag/kotlin">Kotlin</a></li>
        <li class="nav-oop " role="presentation"><a href="/tag/oop">Oop</a></li>
        <li class="nav-springboot " role="presentation"><a href="/tag/springboot">SpringBoot</a></li>
        <li class="nav-ect " role="presentation"><a href="/tag/ect">Ect</a></li>
        <li class="nav-author " role="presentation"><a href="/author/casper">Casper</a></li>
        <li class="nav-author " role="presentation"><a href="/author/edgar">Edgar</a></li>
        <li class="nav-author " role="presentation"><a href="/author/abraham">Abraham</a></li>
        <li class="nav-author " role="presentation"><a href="/author/martin">Martin</a></li>
        <li class="nav-author " role="presentation"><a href="/author/lewis">Lewis</a></li>
    </ul>
    <a class="subscribe-button icon-feed" href="/feed.xml">Subscribe</a>
</div>
<span class="nav-cover"></span>


    <div class="site-wrapper">

        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The comment above "< default" means - insert everything in this file into -->
    <!-- the [body] of the default.hbs template, which contains our header/footer. -->

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<header class="main-header post-head " style="background-image: url(/assets/images/woowa.jpg) ">
    <nav class="main-nav  overlay  clearfix">
        <a class="blog-logo" href="/"><img src="/assets/images/ghost.png" alt="Blog Logo" /></a>
        
            <a class="menu-button icon-menu" href="#"><span class="word">Menu</span></a>
        
    </nav>
    <div class = "amazzi">    
        <h1 class="post-title">📚 atdd-subway-map 미션 정리</h1>
            <section class="post-meta">
            <!-- <a href='/'></a> -->

            
                
                    <a href='/author/amazzi'>✨ new wisdom ✨</a>
                
            
            <time class="post-date" datetime="2021-06-11">11 Jun 2021</time>
                <!-- [[tags prefix=" on "]] -->
                
                on
                
                    
                       <a href='/tag/woowa'>Woowa</a>
                    
                
                
            </section>
    </div>
</header>

<main class="content" role="main">

    <article class="post tag-woowa">

        <header class="post-header">
            
        </header>
        
        <br>

        <section class="post-content">

            <h2 id="step1-2">STEP1, 2</h2>

<h3 id="jwttokenprovider">JwtTokenProvider</h3>

<ul>
  <li>jwt 토큰 생성, 토큰 검증, 토큰에서 인증 정보 추출하는 유틸 클래스</li>
</ul>

<h3 id="authorizationextractor">AuthorizationExtractor</h3>

<ul>
  <li>HTTP의 <code class="highlighter-rouge">Authorization</code> Header에서 Bearer 타입인 경우 Access Token을 추출하는 유틸 클래스</li>
</ul>

<h3 id="authenticationprincipalconfig">AuthenticationPrincipalConfig</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AuthenticationPrincipalConfig</span> <span class="kd">implements</span> <span class="n">WebMvcConfigurer</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">AuthService</span> <span class="n">authService</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">AuthenticationPrincipalConfig</span><span class="o">(</span><span class="n">AuthService</span> <span class="n">authService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">authService</span> <span class="o">=</span> <span class="n">authService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addArgumentResolvers</span><span class="o">(</span><span class="n">List</span> <span class="n">argumentResolvers</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">argumentResolvers</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">createAuthenticationPrincipalArgumentResolver</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">AuthenticationPrincipalArgumentResolver</span> <span class="nf">createAuthenticationPrincipalArgumentResolver</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">AuthenticationPrincipalArgumentResolver</span><span class="o">(</span><span class="n">authService</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>AuthenticationPrincipalArgumentResolver는 빈 등록이 되어있지 않음</li>
  <li>해당 리졸버를 활용할 수 있도록 등록해주는 java config</li>
  <li><code class="highlighter-rouge">AuthenticationPrincipalArgumentResolver</code>를 만들고 등록</li>
</ul>

<h3 id="authenticationprincipalargumentresolver">AuthenticationPrincipalArgumentResolver</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AuthenticationPrincipalArgumentResolver</span> <span class="kd">implements</span> <span class="n">HandlerMethodArgumentResolver</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">AuthService</span> <span class="n">authService</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">AuthenticationPrincipalArgumentResolver</span><span class="o">(</span><span class="n">AuthService</span> <span class="n">authService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">authService</span> <span class="o">=</span> <span class="n">authService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// resolveArgument 메서드가 동작하는 조건을 정의하는 메서드</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">supportsParameter</span><span class="o">(</span><span class="n">MethodParameter</span> <span class="n">parameter</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 파라미터 중 @AuthenticationPrincipal이 붙은 경우 동작하게 설정</span>
        <span class="k">return</span> <span class="n">parameter</span><span class="o">.</span><span class="na">hasParameterAnnotation</span><span class="o">(</span><span class="n">AuthenticationPrincipal</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">// supportsParameter가 true인 경우 동작</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Member</span> <span class="nf">resolveArgument</span><span class="o">(</span><span class="n">MethodParameter</span> <span class="n">parameter</span><span class="o">,</span> <span class="n">ModelAndViewContainer</span> <span class="n">mavContainer</span><span class="o">,</span> <span class="n">NativeWebRequest</span> <span class="n">webRequest</span><span class="o">,</span> <span class="n">WebDataBinderFactory</span> <span class="n">binderFactory</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">token</span> <span class="o">=</span> <span class="n">AuthorizationExtractor</span><span class="o">.</span><span class="na">extract</span><span class="o">((</span><span class="n">HttpServletRequest</span><span class="o">)</span> <span class="n">webRequest</span><span class="o">.</span><span class="na">getNativeRequest</span><span class="o">());</span>
        <span class="k">return</span> <span class="n">authService</span><span class="o">.</span><span class="na">findMemberByToken</span><span class="o">(</span><span class="n">token</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>
    <p>컨트롤러 메서드에서 특정 조건에 맞는 파라미터가 있을 때 원하는 값을 바인딩해주는 인터페이스</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">resolveArgument</code> 에서 <code class="highlighter-rouge">Member</code> 도메인 자체를 반환했었음</p>
  </li>
</ul>

<h4 id="관련-정리">관련 정리</h4>

<ul>
  <li><a href="https://github.com/NewWisdom/TIL/issues/13">Spring MVC Config 학습 테스트</a></li>
</ul>

<h3 id="authinterceptor">AuthInterceptor</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AuthInterceptor</span> <span class="kd">implements</span> <span class="n">HandlerInterceptor</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">AuthService</span> <span class="n">authService</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">AuthInterceptor</span><span class="o">(</span><span class="n">AuthService</span> <span class="n">authService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">authService</span> <span class="o">=</span> <span class="n">authService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">preHandle</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">Object</span> <span class="n">handler</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">token</span> <span class="o">=</span> <span class="n">AuthorizationExtractor</span><span class="o">.</span><span class="na">extract</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
        <span class="n">authService</span><span class="o">.</span><span class="na">validateToken</span><span class="o">(</span><span class="n">token</span><span class="o">);</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>
    <p>인증 / 인가에 대한 토큰 검증을 담당</p>
  </li>
  <li>
    <p>토큰이 유효하면 true를 반환하도록</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">AuthorizationExtractor.extract()</code> 가 리졸버랑 중복이 되는데?</p>

    <ul>
      <li>어쩔 수 없음. 이 둘은 서로 모르는 관계로 독립적이니</li>
      <li>변경의 영향도 최소화를 위해 JwtProvider가 아닌 JwtProvider를 포함한 AuthService를 가지도록</li>
    </ul>
  </li>
</ul>

<h2 id="step3">STEP3</h2>

<h4 id="graph---그래프-역할을-하는-도메인">Graph - 그래프 역할을 하는 도메인</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Graph</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">WeightedMultigraph</span><span class="o">&lt;</span><span class="n">Station</span><span class="o">,</span> <span class="n">DefaultWeightedEdge</span><span class="o">&gt;</span> <span class="n">graph</span> <span class="o">=</span> <span class="k">new</span> <span class="n">WeightedMultigraph</span><span class="o">(</span><span class="n">DefaultWeightedEdge</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="kd">public</span> <span class="nf">Graph</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Section</span><span class="o">&gt;</span> <span class="n">sections</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">initPath</span><span class="o">(</span><span class="n">sections</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">initPath</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Section</span><span class="o">&gt;</span> <span class="n">sections</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Section</span> <span class="n">section</span> <span class="o">:</span> <span class="n">sections</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">initEdge</span><span class="o">(</span><span class="n">section</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">initEdge</span><span class="o">(</span><span class="n">Section</span> <span class="n">section</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">addVertex</span><span class="o">(</span><span class="n">section</span><span class="o">.</span><span class="na">getUpStation</span><span class="o">());</span>
        <span class="n">addVertex</span><span class="o">(</span><span class="n">section</span><span class="o">.</span><span class="na">getDownStation</span><span class="o">());</span>
        <span class="n">graph</span><span class="o">.</span><span class="na">setEdgeWeight</span><span class="o">(</span><span class="n">graph</span><span class="o">.</span><span class="na">addEdge</span><span class="o">(</span><span class="n">section</span><span class="o">.</span><span class="na">getUpStation</span><span class="o">(),</span> <span class="n">section</span><span class="o">.</span><span class="na">getDownStation</span><span class="o">()),</span> <span class="n">section</span><span class="o">.</span><span class="na">getDistance</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">addVertex</span><span class="o">(</span><span class="n">Station</span> <span class="n">station</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">graph</span><span class="o">.</span><span class="na">containsVertex</span><span class="o">(</span><span class="n">station</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">graph</span><span class="o">.</span><span class="na">addVertex</span><span class="o">(</span><span class="n">station</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Path</span> <span class="nf">shortestPath</span><span class="o">(</span><span class="n">Station</span> <span class="n">source</span><span class="o">,</span> <span class="n">Station</span> <span class="n">target</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">DijkstraShortestPath</span><span class="o">&lt;</span><span class="n">Station</span><span class="o">,</span> <span class="n">DefaultWeightedEdge</span><span class="o">&gt;</span> <span class="n">dijkstraShortestPath</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DijkstraShortestPath</span><span class="o">&lt;&gt;(</span><span class="n">graph</span><span class="o">);</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">Path</span><span class="o">(</span><span class="n">dijkstraShortestPath</span><span class="o">.</span><span class="na">getPath</span><span class="o">(</span><span class="n">source</span><span class="o">,</span> <span class="n">target</span><span class="o">).</span><span class="na">getVertexList</span><span class="o">(),</span> <span class="n">dijkstraShortestPath</span><span class="o">.</span><span class="na">getPathWeight</span><span class="o">(</span><span class="n">source</span><span class="o">,</span> <span class="n">target</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h4 id="path---사실상-dto-느낌">Path - 사실상 DTO 느낌…</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Path</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Station</span><span class="o">&gt;</span> <span class="n">stations</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">double</span> <span class="n">distance</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Path</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Station</span><span class="o">&gt;</span> <span class="n">stations</span><span class="o">,</span> <span class="kt">double</span> <span class="n">distance</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">stations</span> <span class="o">=</span> <span class="n">stations</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">distance</span> <span class="o">=</span> <span class="n">distance</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Station</span><span class="o">&gt;</span> <span class="nf">stations</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">stations</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">double</span> <span class="nf">distance</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">distance</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h4 id="처음-구현한-로직---모든-line을-불러와-최단-거리-조회">처음 구현한 로직 - 모든 Line을 불러와 최단 거리 조회</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="n">PathResponse</span> <span class="nf">findPath</span><span class="o">(</span><span class="n">Long</span> <span class="n">sourceId</span><span class="o">,</span> <span class="n">Long</span> <span class="n">targetId</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Line</span><span class="o">&gt;</span> <span class="n">lines</span> <span class="o">=</span> <span class="n">lineDao</span><span class="o">.</span><span class="na">findAll</span><span class="o">();</span>
        <span class="n">Graph</span> <span class="n">graph</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Graph</span><span class="o">(</span><span class="n">lines</span><span class="o">);</span>
        <span class="n">Path</span> <span class="n">path</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="na">shortestPath</span><span class="o">(</span><span class="n">stationDao</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">sourceId</span><span class="o">),</span> <span class="n">stationDao</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">targetId</span><span class="o">));</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">PathResponse</span><span class="o">(</span><span class="n">StationResponse</span><span class="o">.</span><span class="na">listOf</span><span class="o">(</span><span class="n">path</span><span class="o">.</span><span class="na">stations</span><span class="o">()),</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">path</span><span class="o">.</span><span class="na">distance</span><span class="o">());</span>
    <span class="o">}</span>
</code></pre></div></div>

<p><img src="https://images.velog.io/images/new_wisdom/post/452f11f4-a8e7-4365-a71c-9c2be5f6435a/image.png" style="zoom:50%;" /></p>

<ul>
  <li>사실 처음에는 sections만 가져와서 그래프를 그렸으나, 이렇게 되면 해당 역의 이름들을 가져올 수 없었음</li>
  <li>기존 코드를 사용하려고 일단 LineDao를 이용했었는데, 재연링의 리뷰대로 모든 Line을 조회하기 보다 필요한 Sections만 조회하도록 리팩토링</li>
</ul>

<p><img src="https://images.velog.io/images/new_wisdom/post/88d775c4-942a-4437-8f62-a7b0215a96a1/image.png" style="zoom:50%;" /></p>

<ul>
  <li>이 부분은 DM으로 이야기를 나눴는데,</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PathService</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">SectionDao</span> <span class="n">sectionDao</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">StationDao</span> <span class="n">stationDao</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">PathService</span><span class="o">(</span><span class="n">SectionDao</span> <span class="n">sectionDao</span><span class="o">,</span> <span class="n">StationDao</span> <span class="n">stationDao</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">sectionDao</span> <span class="o">=</span> <span class="n">sectionDao</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">stationDao</span> <span class="o">=</span> <span class="n">stationDao</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">PathResponse</span> <span class="nf">findPath</span><span class="o">(</span><span class="n">Long</span> <span class="n">sourceId</span><span class="o">,</span> <span class="n">Long</span> <span class="n">targetId</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Section</span><span class="o">&gt;</span> <span class="n">sections</span> <span class="o">=</span> <span class="n">sectionDao</span><span class="o">.</span><span class="na">findByStationIds</span><span class="o">(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">sourceId</span><span class="o">,</span> <span class="n">targetId</span><span class="o">));</span>
        <span class="n">Graph</span> <span class="n">graph</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Graph</span><span class="o">(</span><span class="n">sections</span><span class="o">);</span>
        <span class="n">Path</span> <span class="n">path</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="na">shortestPath</span><span class="o">(</span><span class="k">new</span> <span class="n">Station</span><span class="o">(</span><span class="n">sourceId</span><span class="o">),</span> <span class="k">new</span> <span class="n">Station</span><span class="o">(</span><span class="n">targetId</span><span class="o">));</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">PathResponse</span><span class="o">(</span><span class="n">StationResponse</span><span class="o">.</span><span class="na">listOf</span><span class="o">(</span><span class="n">combineStationById</span><span class="o">(</span><span class="n">path</span><span class="o">)),</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">path</span><span class="o">.</span><span class="na">distance</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Station</span><span class="o">&gt;</span> <span class="nf">combineStationById</span><span class="o">(</span><span class="n">Path</span> <span class="n">path</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="n">stationIds</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="na">stations</span><span class="o">()</span>
                <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">Station:</span><span class="o">:</span><span class="n">getId</span><span class="o">)</span>
                <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
        <span class="k">return</span> <span class="n">stationDao</span><span class="o">.</span><span class="na">findByIds</span><span class="o">(</span><span class="n">stationIds</span><span class="o">).</span><span class="na">sortedStation</span><span class="o">(</span><span class="n">stationIds</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="cookie-vs-localstorage">Cookie vs LocalStorage</h2>

<p><img src="https://images.velog.io/images/new_wisdom/post/4d9503c2-642a-4ed5-9531-acfc39e6f29b/image.png" style="zoom:50%;" /></p>

<ul>
  <li><a href="https://woowacourse.github.io/javable/post/2020-08-31-where_to_store_token/">토큰을 어디에 저장할까?</a> 글을 보고 토큰을 쿠키에 저장</li>
  <li>재연링의 리뷰로 쿠키를 사용했을 때의 문제점을 알아봄</li>
  <li>XSS 공격을 막을 수 있는 HTTP-Only 쿠키를 고려</li>
  <li>하지만 이는 JS에서 꺼내 쓸 수 없어 헤더에 토큰을 실어 보낼 수 없는 이슈</li>
  <li>(미션 요구사항과 OAuth 표준 등을 고려해) 재연링과 나눈 DM 내용과 같이 다음과 같은 문제들로 쿠키 대신 LocalStorage에 토큰을 저장하도록 변경</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>* 웹 이외의 클라이언트까지 고려하는 것이 좋다고 생각
* OAuth 표준을 지키기 위함
* 사실 HttpOnly를 통해 보호하여도, 하이재킹 등 많은 보안적 위험이 존재하기 때문에 악의적인 의도를 가진 사람이 불편해질 뿐 보안적으로 완벽하게 처리되지 않음
* MDN에서도 HTML5 이후부터 Cookie를 저장소와 같은 용도로 사용하지 않을 것을 권장
</code></pre></div></div>

<h4 id="정리">정리</h4>

<ul>
  <li><a href="https://github.com/NewWisdom/TIL/issues/21">XSS, CSRF</a></li>
  <li><a href="https://github.com/NewWisdom/TIL/issues/22">SameSite Cookie</a></li>
  <li><a href="https://github.com/NewWisdom/TIL/issues/33">Cookie VS Local Storage</a></li>
</ul>

<h2 id="front">Front</h2>

<p><img src="https://images.velog.io/images/new_wisdom/post/a00c23b4-79f3-46f2-891d-863f25e8a418/image.png" style="zoom:50%;" /></p>

<ul>
  <li><code class="highlighter-rouge">vue.config</code>를 통해 중복되는 URL에 대한 설정</li>
  <li>중복되는 fetch는 모듈로 따로 만들어서(fetch.js) 사용하도록 변경</li>
</ul>

<p><img src="https://images.velog.io/images/new_wisdom/post/4b5e5a10-0ebf-4d5b-8750-b6a5ccf92652/image.png" style="zoom:50%;" /></p>

<h2 id="argumentresolver와-authinterceptor">ArgumentResolver와 AuthInterceptor</h2>

<p><img src="https://images.velog.io/images/new_wisdom/post/336584ce-5eaf-45d6-ab2f-c4066eb03ab1/image.png" style="zoom:50%;" /></p>

<h4 id="argumentresolver">ArgumentResolver</h4>
<blockquote>
  <p>Strategy interface for resolving method parameters into argument values in the context of a given request.</p>
  <ul>
    <li>매개변수의 리졸빙</li>
    <li>컨트롤러에서 파라미터를 바인딩 해주는 역할
      <h4 id="authinterceptor-1">AuthInterceptor</h4>
      <p>Workflow interface that allows for customized handler execution chains. Applications can register any number of existing or custom interceptors for certain groups of handlers, to add common preprocessing behavior without needing to modify each handler implementation.
A HandlerInterceptor gets called before the appropriate HandlerAdapter triggers the execution of the handler itself. This mechanism can be used for a large field of preprocessing aspects, e.g. for authorization checks, or common handler behavior like locale or theme changes. Its main purpose is to allow for factoring out repetitive handler code.</p>
    </li>
    <li>권한 확인 또는 로케일 또는 테마 변경과 같은 일반적인 핸들러 동작과 같은 전처리 측면의 넓은 분야에 사용</li>
    <li>인증 / 인가에 대한 검사</li>
    <li>주요 목적은 반복적 인 핸들러 코드를 제거하는 것</li>
    <li>Spring doc에서 공식적으로 authorization checks를 하는 애라고 지정해준 존재</li>
    <li><a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/servlet/HandlerInterceptor.html">공식문서</a></li>
  </ul>
</blockquote>

<p><strong>인터셉터와 리졸버는 서로를 모르는 관계이고 독립적으로 가야함</strong></p>
<h4 id="참고할-글">참고할 글</h4>
<ul>
  <li><a href="https://velog.io/@sa833591/Spring-Filter-Interceptor-AOP-%EC%B0%A8%EC%9D%B4-yvmv4k96">Filter, Interceptor, AOP 차이
</a></li>
</ul>

<h4 id="정리-1">정리</h4>

<ul>
  <li><a href="https://github.com/NewWisdom/TIL/issues/28">HandlerInterceptor</a></li>
</ul>

<h2 id="다시-구현한다면">다시 구현한다면?</h2>

<h4 id="argumentresolver-에서-dto인-loginmember를-반환하게-할걸">ArgumentResolver 에서 DTO인 LoginMember를 반환하게 할걸!</h4>

<ul>
  <li>도메인을 반환하면 뷰와 컨트롤러에 노출시키고 도메인을 조작할 가능성이 있음</li>
  <li>또 불필요한 pw 필드도 가지게 됨</li>
</ul>

<h4 id="비번-암호화와-member-객체에서-비번을-확인하게-할걸">비번 암호화와 member 객체에서 비번을 확인하게 할걸!</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="n">TokenResponse</span> <span class="nf">createToken</span><span class="o">(</span><span class="n">TokenRequest</span> <span class="n">tokenRequest</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Member</span> <span class="n">member</span> <span class="o">=</span> <span class="n">memberDao</span><span class="o">.</span><span class="na">findByEmailAndPassword</span><span class="o">(</span><span class="n">tokenRequest</span><span class="o">.</span><span class="na">getEmail</span><span class="o">(),</span> <span class="n">tokenRequest</span><span class="o">.</span><span class="na">getPassword</span><span class="o">())</span>
            <span class="o">.</span><span class="na">orElseThrow</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="n">AuthorizationException</span><span class="o">(</span><span class="s">"로그인 실패입니다."</span><span class="o">));</span>
    <span class="n">String</span> <span class="n">accessToken</span> <span class="o">=</span> <span class="n">jwtTokenProvider</span><span class="o">.</span><span class="na">createToken</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">member</span><span class="o">.</span><span class="na">getId</span><span class="o">()));</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">TokenResponse</span><span class="o">(</span><span class="n">accessToken</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>비번을 암호화 할 때는 Spring Security의 <code class="highlighter-rouge">BCryptPasswordEncoder()</code> 를 사용</li>
  <li>회원가입할 때 입력한 비번을 인코딩하여 저장</li>
  <li>그런데 만약 여기서 로그인할 때 입력한 비번을 <code class="highlighter-rouge">encoder.encode()</code> 하여 조회하면 실패</li>
  <li>왜냐면 동일한 원문이어도 각기 다른 인코딩된 값을 내뱉기 때문</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">PasswordEncoder</span> <span class="n">encoder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BCryptPasswordEncoder</span><span class="o">();</span>
<span class="n">String</span> <span class="err">원문</span> <span class="o">=</span> <span class="s">"qwe123"</span><span class="o">;</span>
<span class="n">String</span> <span class="err">암호화된</span><span class="n">_</span><span class="err">원문</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="err">원문</span><span class="o">);</span>
<span class="n">String</span> <span class="err">암호화된</span><span class="n">_</span><span class="err">원문</span><span class="n">_2</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="err">원문</span><span class="o">);</span>

<span class="n">encorder</span><span class="o">.</span><span class="na">matches</span><span class="o">(</span><span class="err">원문</span><span class="o">,</span> <span class="err">암호화된</span> <span class="err">원문</span><span class="o">);</span> <span class="c1">// true</span>
<span class="err">암호화된</span><span class="n">_</span><span class="err">원문</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="err">암호화된</span><span class="n">_</span><span class="err">원문</span><span class="mi">2</span><span class="o">);</span> <span class="c1">//false</span>
</code></pre></div></div>

<ul>
  <li>때문에 쿼리로 Member를 받아오고 이 객체에서 <code class="highlighter-rouge">encorder.matches()</code>를 이용해 비번을 확인하자</li>
</ul>

<h4 id="최단거리-찾는-로직을-전략-패턴으로-구현할걸">최단거리 찾는 로직을 전략 패턴으로 구현할걸!</h4>

<ul>
  <li>도메인에 외부 라이브러리를 가지고 있는 것이 옳은가?</li>
  <li>만약 알고리즘이 변경되면 도메인에도 영향이 감</li>
  <li>전략패턴으로 Dijkstra 알고리즘을 주입하자</li>
</ul>

<p>CredentialRequest</p>

<p>세션으로 로그인 처리 브라우저에 쿠키가 있으면 자동으로 실어보냄</p>



        </section>

        <footer class="post-footer">

            <!-- Everything inside the #author tags pulls data from the author -->
            <!-- #author-->
            
                
                    
                        <figure class="author-image">
                            <a class="img" href="/author/amazzi" style="background-image: url(/assets/images/amazzi.jpeg)"><span class="hidden">amazzi's Picture</span></a>
                        </figure>
                    

                    <section class="author">
                        <h4><a href="/author/amazzi">✨ new wisdom ✨</a></h4>

                        
                            <p> I want to be a person who gives you new wisdom.</p>
                        
                        <div class="author-meta">
                            <span class="author-location icon-location"> Seoul, South Korea</span>
                            <span class="author-link icon-link"><a href="https://newwisdom.github.io/"> newwisdom.github.io/</a></span>
                        </div>
                    </section>

                    <!-- /author  -->

                    <section class="share">
                        <h4>Share this post</h4>
                        <a class="icon-twitter" href="http://twitter.com/share?text=📚 atdd-subway-map 미션 정리&amp;url=http://localhost:4000atdd-subway-path-note"
                            onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                            <span class="hidden">Twitter</span>
                        </a>
                        <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000atdd-subway-path-note"
                            onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                            <span class="hidden">Facebook</span>
                        </a>
                        <a class="icon-google-plus" href="https://plus.google.com/share?url=http://localhost:4000atdd-subway-path-note"
                           onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                            <span class="hidden">Google+</span>
                        </a>
                    </section>
                
            

            <!-- Add Disqus Comments -->
            

        </footer>

    </article>

</main>

<aside class="read-next">

    <!-- [[! next_post ]] -->
    
        <a class="read-next-story no-cover" href="/hash-and-salt">
            <section class="post">
                <h2>Hash And Salt</h2>
                <p></p>
            </section>
        </a>
    
    <!-- [[! /next_post ]] -->
    <!-- [[! prev_post ]] -->
    
        <a class="read-next-story prev " style="background-image: url(/assets/images/woowa.jpg)" href="/atdd-subway-map">
            <section class="post">
                <h2>📚 atdd-subway-map 미션 정리</h2>
                <p>중복되는 테스트 메서드 중복되는 테스트 메서드는 추출하자 테스트코드도 유지보수의 대상이며 하나의 문서이기 때문에 가독성을 고려하자...</p>
            </section>
        </a>
    
    <!-- [[! /prev_post ]] -->
</aside>

<!-- /post -->


        <!-- The tiny footer at the very bottom -->
        <footer class="site-footer clearfix">
          <section class="copyright"><a href="/">Welcome To New Wisdom's Log !</a> &copy; 2021</section>
          <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> using <a href="https://github.com/jekyller/jasper">Jasper</a></section>
        </footer>
    </div>
    <!-- highlight.js -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- jQuery needs to come before `` so that jQuery can be used in code injection -->
    <script type="text/javascript" src="//code.jquery.com/jquery-1.12.0.min.js"></script>
    <!-- Ghost outputs important scripts and data with this tag -->
    <!--  -->
    <!-- Add Google Analytics  -->
        <!-- Google Analytics Tracking code -->
     <script>
	    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	    ga('create', 'G-09YB1TZP06', 'auto');
	    ga('send', 'pageview');

     </script>
    <!-- Fitvids makes video embeds responsive and awesome -->
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <!-- The main JavaScript file for Casper -->
    <script type="text/javascript" src="/assets/js/index.js"></script>

</body>
</html>
